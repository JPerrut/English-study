<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English Pro - Aprenda com Hist√≥rias</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #f59e0b;
      --secondary-dark: #d97706;
      --dark: #1e293b;
      --darker: #0f172a;
      --light: #f8fafc;
      --gray: #64748b;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--darker), #1e1b4b);
      color: var(--light);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }
    .container {
      width: 100%;
      max-width: 800px;
      background-color: rgba(30, 41, 59, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      padding: 24px;
      text-align: center;
      position: relative;
    }
    .header h1 {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 8px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .header p {
      font-size: 16px;
      opacity: 0.9;
    }
    .content {
      padding: 32px;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 16px 24px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
    }
    .btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .btn:hover::after {
      left: 100%;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
    }
    .btn-secondary {
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      color: var(--darker);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4);
    }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    .btn-small {
      padding: 12px 20px;
      font-size: 16px;
      width: auto;
      display: inline-block;
      margin-right: 12px;
    }
    .chapters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }
    .chapter-card {
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .chapter-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      border-color: var(--primary);
    }
    .chapter-number {
      font-size: 14px;
      color: var(--gray);
      margin-bottom: 8px;
    }
    .chapter-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .chapter-stats {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--gray);
    }
    .question-container {
      background: rgba(30, 41, 59, 0.7);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .question-number {
      font-size: 14px;
      color: var(--gray);
    }
    .progress-bar {
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    .progress {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transition: width 0.5s ease;
    }
    .question-text {
      font-size: 20px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 24px;
      line-height: 1.5;
      padding: 16px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 12px;
    }
    .input-container {
      margin-bottom: 24px;
    }
    .answer-input {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.5);
      color: white;
      font-size: 18px;
      transition: all 0.3s ease;
    }
    .answer-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }
    .feedback-container {
      background: rgba(15, 23, 42, 0.7);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border-left: 4px solid var(--primary);
    }
    .feedback-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .correct-answer {
      font-size: 18px;
      font-weight: 600;
      color: var(--success);
      margin-bottom: 16px;
      padding: 12px;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 8px;
    }
    .vocab-section {
      margin-top: 20px;
    }
    .vocab-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--secondary);
    }
    .vocab-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .vocab-table th, .vocab-table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .vocab-table th {
      color: var(--gray);
      font-weight: 500;
    }
    .word-feedback {
      margin: 16px 0;
      padding: 16px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 8px;
    }
    .word-feedback-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--secondary);
    }
    .word-feedback-content {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .word-bubble {
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }
    .word-correct {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      border: 1px solid var(--success);
    }
    .word-wrong-position {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
      border: 1px solid var(--warning);
    }
    .word-incorrect {
      background: rgba(239, 68, 68, 0.2);
      color: var(--error);
      border: 1px solid var(--error);
    }
    .word-missing {
      background: rgba(100, 116, 139, 0.2);
      color: var(--gray);
      border: 1px solid var(--gray);
      text-decoration: line-through;
    }
    .retry-container {
      text-align: center;
      margin-top: 20px;
      padding: 16px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 8px;
      border-left: 4px solid var(--warning);
    }
    .retry-message {
      font-size: 16px;
      margin-bottom: 12px;
      color: var(--warning);
    }
    .hidden {
      display: none !important;
    }
    .text-center {
      text-align: center;
    }
    .mt-4 {
      margin-top: 24px;
    }
    .mb-4 {
      margin-bottom: 24px;
    }
    .icon {
      margin-right: 8px;
    }
    .score-display {
      text-align: center;
      padding: 32px;
    }
    .score-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(var(--primary) 0%, var(--dark) 0%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      position: relative;
    }
    .score-circle::before {
      content: '';
      position: absolute;
      width: 100px;
      height: 100px;
      background: var(--darker);
      border-radius: 50%;
    }
    .score-value {
      position: relative;
      z-index: 1;
      font-size: 28px;
      font-weight: 700;
    }
    .completion-message {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      margin: 24px 0;
    }
    .stat {
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }
    .stat-label {
      font-size: 14px;
      color: var(--gray);
    }
    @media (max-width: 600px) {
      .content {
        padding: 20px;
      }
      .header h1 {
        font-size: 24px;
      }
      .question-text {
        font-size: 18px;
      }
      .btn {
        padding: 14px 20px;
        font-size: 16px;
      }
      .chapters-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Menu Principal -->
    <div id="main-menu">
      <div class="header">
        <h1><i class="fas fa-language icon"></i>English Pro</h1>
        <p>Aprenda ingl√™s com suas hist√≥rias favoritas</p>
      </div>
      <div class="content">
        <button id="story-mode-btn" class="btn btn-primary">
          <i class="fas fa-book-open icon"></i>Ingl√™s com Hist√≥ria
        </button>
      </div>
    </div>
    <!-- Sele√ß√£o de Cap√≠tulo -->
    <div id="chapters-menu" class="hidden">
      <div class="header">
        <button id="back-to-main" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1><i class="fas fa-book icon"></i>Cap√≠tulos</h1>
        <p>Selecione um cap√≠tulo para praticar</p>
      </div>
      <div class="content">
        <div class="chapters-grid" id="chapters-grid">
          <!-- Cap√≠tulos ser√£o gerados dinamicamente -->
        </div>
      </div>
    </div>
    <!-- Sele√ß√£o de N√≠vel -->
    <div id="level-menu" class="hidden">
      <div class="header">
        <button id="back-to-chapters" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1 id="chapter-level-title">Cap√≠tulo </h1>
        <p>Escolha um n√≠vel para praticar</p>
      </div>
      <div class="content" id="levels-grid">
        <!-- N√≠veis ser√£o gerados dinamicamente -->
      </div>
    </div>
    <!-- Sele√ß√£o de Modo de Pr√°tica -->
    <div id="practice-mode-menu" class="hidden">
      <div class="header">
        <button id="back-to-levels" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1 id="chapter-practice-title">N√≠vel </h1>
        <p>Selecione o modo de pr√°tica</p>
      </div>
      <div class="content">
        <button id="easy-practice-btn" class="btn btn-primary">
          <i class="fas fa-star icon"></i>Pr√°tica F√°cil
          <br><small>Traduza do Ingl√™s para Portugu√™s</small>
        </button>
        <button id="hard-practice-btn" class="btn btn-secondary">
          <i class="fas fa-fire icon"></i>Pr√°tica Dif√≠cil
          <br><small>Traduza do Portugu√™s para Ingl√™s</small>
        </button>
      </div>
    </div>
    <!-- Tela de Quest√µes -->
    <div id="quiz-screen" class="hidden">
      <div class="header">
        <button id="back-to-practice" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1 id="quiz-title">Pr√°tica</h1>
        <p id="quiz-subtitle">Traduza a frase abaixo</p>
      </div>
      <div class="content">
        <div class="question-container">
          <div class="question-header">
            <div class="question-number" id="question-number">Quest√£o 1 de 5</div>
            <div class="question-stats" id="question-stats">Acertos: 0 | Erros: 0</div>
          </div>
          <div class="progress-bar">
            <div class="progress" id="progress-bar" style="width: 0%"></div>
          </div>
          <div class="question-text" id="question-text"></div>
          <div class="input-container">
            <input type="text" class="answer-input" id="answer-input" placeholder="Digite sua tradu√ß√£o aqui...">
          </div>
          <button id="submit-answer" class="btn btn-primary">Verificar Resposta</button>
          <button id="skip-button" class="btn btn-outline mt-4">Pular Frase</button>
        </div>
        <div id="feedback-area" class="feedback-container hidden">
          <div class="feedback-title">
            <i class="fas fa-info-circle" id="feedback-icon"></i>
            <span id="feedback-title-text">Feedback</span>
          </div>
          <div class="correct-answer" id="correct-answer"></div>
          <div id="word-feedback-area" class="word-feedback hidden">
            <div class="word-feedback-title">
              <i class="fas fa-spell-check icon"></i>An√°lise das Palavras:
            </div>
            <div class="word-feedback-content" id="word-feedback-content">
              <!-- Conte√∫do gerado dinamicamente -->
            </div>
          </div>
          <div id="retry-container" class="retry-container hidden">
            <div class="retry-message">
              <i class="fas fa-redo-alt icon"></i>Tente novamente corrigindo as palavras destacadas
            </div>
            <button id="retry-button" class="btn btn-primary btn-small">Tentar Novamente</button>
          </div>
          <div class="vocab-section">
            <div class="vocab-title">
              <i class="fas fa-book icon"></i>Tradu√ß√£o das Palavras
            </div>
            <table class="vocab-table" id="vocab-table">
              <!-- Conte√∫do gerado dinamicamente -->
            </table>
          </div>
          <button id="next-question" class="btn btn-primary mt-4">Pr√≥xima Quest√£o</button>
        </div>
      </div>
    </div>
    <!-- Tela de Resultados -->
    <div id="results-screen" class="hidden">
      <div class="header">
        <h1><i class="fas fa-trophy icon"></i>Resultados</h1>
        <p id="results-subtitle">Desempenho no cap√≠tulo</p>
      </div>
      <div class="content">
        <div class="score-display">
          <div class="score-circle" id="score-circle">
            <div class="score-value" id="score-value">0%</div>
          </div>
          <div class="completion-message" id="completion-message">Parab√©ns!</div>
          <div class="stats">
            <div class="stat">
              <div class="stat-value" id="correct-answers">0</div>
              <div class="stat-label">Acertos</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="wrong-answers">0</div>
              <div class="stat-label">Erros</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="completion-rate">0%</div>
              <div class="stat-label">Conclu√≠do</div>
            </div>
          </div>
          <button id="restart-practice" class="btn btn-primary">Refazer Pr√°tica</button>
          <button id="back-to-chapters-from-results" class="btn btn-outline mt-4">Voltar aos Cap√≠tulos</button>
        </div>
      </div>
    </div>
  </div>
<script>
    // Dados organizados por cap√≠tulo e n√≠vel
    const CHAPTERS = [
      {
        id: 2,
        title: "Chapter 002",
        description: "Rotina, Trabalho e Pequenos Problemas do Dia a Dia",
        levels: [
          {
            id: 1,
            name: "N√≠vel 1",
            description: "Frases simples sobre rotina e necessidades b√°sicas",
            estimatedTime: "~1 minuto",
            phrases: [
              { 
                english: "I wake up at 7 a.m. every day.", 
                portuguese: "Eu acordo √†s 7 da manh√£ todos os dias.", 
                alternativeTranslations: [
                  "Acordo √†s sete da manh√£ todo dia.",
                  "Todo dia eu levanto √†s 7h.",
                  "Levanto √†s sete da manh√£ diariamente."
                ] 
              },
              { 
                english: "The bus is always late.", 
                portuguese: "O √¥nibus sempre atrasa.", 
                alternativeTranslations: [
                  "O √¥nibus sempre chega atrasado.",
                  "Esse √¥nibus nunca chega na hora.",
                  "O coletivo sempre atrasa."
                ] 
              },
              { 
                english: "I need to charge my phone.", 
                portuguese: "Preciso carregar meu celular.", 
                alternativeTranslations: [
                  "Tenho que botar meu celular pra carregar.",
                  "Meu celular precisa ser carregado.",
                  "T√¥ precisando carregar o celular."
                ] 
              },
              { 
                english: "She drinks coffee in the morning.", 
                portuguese: "Ela toma caf√© de manh√£.", 
                alternativeTranslations: [
                  "Ela bebe caf√© pela manh√£.",
                  "De manh√£, ela toma um caf√©.",
                  "Ela toma um cafezinho de manh√£."
                ] 
              },
              { 
                english: "We eat dinner at 8 p.m.", 
                portuguese: "N√≥s jantamos √†s 8 da noite.", 
                alternativeTranslations: [
                  "Jantamos √†s oito.",
                  "O jantar √© √†s 20h.",
                  "A gente janta √†s oito da noite."
                ] 
              }
            ]
          },
          {
            id: 2,
            name: "N√≠vel 2",
            description: "Situa√ß√µes sociais e pequenas frustra√ß√µes cotidianas",
            estimatedTime: "~1 minuto",
            phrases: [
              { 
                english: "Sorry, I didn‚Äôt catch your name.", 
                portuguese: "Desculpe, n√£o entendi seu nome.", 
                alternativeTranslations: [
                  "Desculpa, n√£o peguei seu nome.",
                  "Pode repetir seu nome? N√£o ouvi direito.",
                  "N√£o consegui ouvir seu nome, desculpe."
                ] 
              },
              { 
                english: "My internet connection is really slow today.", 
                portuguese: "Minha internet est√° muito lenta hoje.", 
                alternativeTranslations: [
                  "A internet t√° uma bosta hoje.",
                  "Hoje a internet t√° travando demais.",
                  "Meu sinal de internet t√° p√©ssimo hoje."
                ] 
              },
              { 
                english: "Could I borrow your pen for a second?", 
                portuguese: "Posso pegar sua caneta emprestada por um segundo?", 
                alternativeTranslations: [
                  "D√° pra eu usar sua caneta um instante?",
                  "Me empresta sua caneta rapidinho?",
                  "Pode me emprestar sua caneta por um segundo?"
                ] 
              },
              { 
                english: "I forgot my keys again.", 
                portuguese: "Esqueci minhas chaves de novo.", 
                alternativeTranslations: [
                  "De novo esqueci as chaves.",
                  "T√¥ sempre esquecendo as chaves.",
                  "Esqueci as chaves outra vez."
                ] 
              },
              { 
                english: "This traffic is driving me crazy.", 
                portuguese: "Esse tr√¢nsito est√° me deixando louco.", 
                alternativeTranslations: [
                  "Esse tr√¢nsito t√° me matando.",
                  "N√£o aguento mais esse tr√¢nsito.",
                  "T√¥ pirando com esse tr√¢nsito."
                ] 
              }
            ]
          },
          {
            id: 3,
            name: "N√≠vel 3",
            description: "Express√µes idiom√°ticas e rea√ß√µes naturais",
            estimatedTime: "~1 minuto",
            phrases: [
              { 
                english: "I‚Äôm swamped with work this week.", 
                portuguese: "Estou atolado de trabalho esta semana.", 
                alternativeTranslations: [
                  "T√¥ afogado em trabalho essa semana.",
                  "Essa semana t√¥ cheio de servi√ßo.",
                  "N√£o t√¥ dando conta do trabalho essa semana."
                ] 
              },
              { 
                english: "Let‚Äôs play it by ear.", 
                portuguese: "Vamos decidir na hora.", 
                alternativeTranslations: [
                  "Vamos ver como as coisas v√£o e decidir depois.",
                  "Deixa pra l√°, a gente v√™ no dia.",
                  "Melhor ir no improviso."
                ] 
              },
              { 
                english: "It slipped my mind.", 
                portuguese: "Passou batido na minha cabe√ßa.", 
                alternativeTranslations: [
                  "Esqueci completamente.",
                  "Saiu da minha mente.",
                  "Deu um branco."
                ] 
              },
              { 
                english: "I‚Äôm beat after that meeting.", 
                portuguese: "Estou exausto depois dessa reuni√£o.", 
                alternativeTranslations: [
                  "T√¥ morto depois dessa reuni√£o.",
                  "Essa reuni√£o me deixou derrubado.",
                  "Fiquei sem energia depois da reuni√£o."
                ] 
              },
              { 
                english: "Don‚Äôt put all your eggs in one basket.", 
                portuguese: "N√£o coloque todos os seus ovos numa √∫nica cesta.", 
                alternativeTranslations: [
                  "N√£o aposte tudo numa s√≥ coisa.",
                  "√â arriscado depender s√≥ disso.",
                  "Melhor n√£o concentrar tudo num √∫nico lugar."
                ] 
              }
            ]
          }
        ]
      }
    ];
    // Estado do aplicativo
    let currentState = {
      currentChapter: null,
      currentLevel: null,
      currentMode: null,
      currentQuestions: [],
      wrongAnswers: [],
      currentQuestionIndex: 0,
      correctCount: 0,
      wrongCount: 0,
      isReviewMode: false,
      currentAttempt: 1,
      currentQuestionAnalysis: null
    };

    // Elementos DOM
    const elements = {
      // Telas
      mainMenu: document.getElementById('main-menu'),
      chaptersMenu: document.getElementById('chapters-menu'),
      levelMenu: document.getElementById('level-menu'),
      practiceModeMenu: document.getElementById('practice-mode-menu'),
      quizScreen: document.getElementById('quiz-screen'),
      resultsScreen: document.getElementById('results-screen'),
      // Bot√µes de navega√ß√£o
      storyModeBtn: document.getElementById('story-mode-btn'),
      backToMain: document.getElementById('back-to-main'),
      backToChapters: document.getElementById('back-to-chapters'),
      backToLevels: document.getElementById('back-to-levels'),
      backToPractice: document.getElementById('back-to-practice'),
      backToChaptersFromResults: document.getElementById('back-to-chapters-from-results'),
      // Elementos do quiz
      chapterLevelTitle: document.getElementById('chapter-level-title'),
      chapterPracticeTitle: document.getElementById('chapter-practice-title'),
      quizTitle: document.getElementById('quiz-title'),
      quizSubtitle: document.getElementById('quiz-subtitle'),
      questionNumber: document.getElementById('question-number'),
      questionStats: document.getElementById('question-stats'),
      progressBar: document.getElementById('progress-bar'),
      questionText: document.getElementById('question-text'),
      answerInput: document.getElementById('answer-input'),
      submitAnswer: document.getElementById('submit-answer'),
      skipButton: document.getElementById('skip-button'),
      // Elementos de feedback
      feedbackArea: document.getElementById('feedback-area'),
      feedbackIcon: document.getElementById('feedback-icon'),
      feedbackTitle: document.getElementById('feedback-title-text'),
      correctAnswer: document.getElementById('correct-answer'),
      vocabTable: document.getElementById('vocab-table'),
      nextQuestion: document.getElementById('next-question'),
      wordFeedbackArea: document.getElementById('word-feedback-area'),
      wordFeedbackContent: document.getElementById('word-feedback-content'),
      retryContainer: document.getElementById('retry-container'),
      retryButton: document.getElementById('retry-button'),
      // Elementos de resultados
      resultsSubtitle: document.getElementById('results-subtitle'),
      scoreCircle: document.getElementById('score-circle'),
      scoreValue: document.getElementById('score-value'),
      completionMessage: document.getElementById('completion-message'),
      correctAnswers: document.getElementById('correct-answers'),
      wrongAnswers: document.getElementById('wrong-answers'),
      completionRate: document.getElementById('completion-rate'),
      restartPractice: document.getElementById('restart-practice'),
      // Grids
      chaptersGrid: document.getElementById('chapters-grid'),
      levelsGrid: document.getElementById('levels-grid'),
      // Bot√µes de modo de pr√°tica
      easyPracticeBtn: document.getElementById('easy-practice-btn'),
      hardPracticeBtn: document.getElementById('hard-practice-btn')
    };

    // Inicializa√ß√£o
    function init() {
      // Garante que apenas o menu principal est√° vis√≠vel no in√≠cio
      hideAllScreens();
      elements.mainMenu.classList.remove('hidden');
      
      renderChaptersGrid();
      attachEventListeners();
    }

    // Anexar event listeners
    function attachEventListeners() {
      elements.storyModeBtn.addEventListener('click', showChaptersMenu);
      elements.backToMain.addEventListener('click', showMainMenu);
      elements.backToChapters.addEventListener('click', showChaptersMenu);
      elements.backToLevels.addEventListener('click', () => {
        if (currentState.currentChapter) {
          showLevelMenu(currentState.currentChapter);
        }
      });
      elements.backToPractice.addEventListener('click', () => {
        if (currentState.currentLevel) {
          showPracticeModeMenu(currentState.currentLevel);
        }
      });
      elements.backToChaptersFromResults.addEventListener('click', showChaptersMenu);
      elements.easyPracticeBtn.addEventListener('click', () => startPractice('easy'));
      elements.hardPracticeBtn.addEventListener('click', () => startPractice('hard'));
      elements.submitAnswer.addEventListener('click', checkAnswer);
      elements.skipButton.addEventListener('click', skipQuestion);
      elements.nextQuestion.addEventListener('click', nextQuestion);
      elements.retryButton.addEventListener('click', enableRetry);
      elements.answerInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          if (elements.feedbackArea.classList.contains('hidden')) {
            checkAnswer();
          } else if (!elements.retryContainer.classList.contains('hidden')) {
            enableRetry();
          } else {
            nextQuestion();
          }
        }
      });
      elements.restartPractice.addEventListener('click', () => {
        startPractice(currentState.currentMode);
      });
    }

    // Fun√ß√µes de navega√ß√£o
    function showMainMenu() {
      hideAllScreens();
      elements.mainMenu.classList.remove('hidden');
    }

    function showChaptersMenu() {
      hideAllScreens();
      elements.chaptersMenu.classList.remove('hidden');
    }

    // Renderizar cap√≠tulos
    function renderChaptersGrid() {
      elements.chaptersGrid.innerHTML = CHAPTERS.map(chapter => `
        <div class="chapter-card" data-chapter-id="${chapter.id}">
          <div class="chapter-number">Cap√≠tulo ${chapter.id.toString().padStart(3, '0')}</div>
          <div class="chapter-title">${chapter.title}</div>
          <div class="chapter-stats">
            <span>3 n√≠veis</span>
            <span><i class="fas fa-star"></i> ${chapter.id}.0</span>
          </div>
        </div>
      `).join('');

      document.querySelectorAll('.chapter-card').forEach(card => {
        card.addEventListener('click', () => {
          const chapterId = parseInt(card.getAttribute('data-chapter-id'));
          const chapter = CHAPTERS.find(c => c.id === chapterId);
          if (chapter) {
            showLevelMenu(chapter);
          }
        });
      });
    }

    // Mostrar menu de n√≠veis
    function showLevelMenu(chapter) {
      hideAllScreens();
      currentState.currentChapter = chapter;
      elements.chapterLevelTitle.textContent = `Cap√≠tulo ${chapter.id.toString().padStart(3, '0')} - ${chapter.title}`;
      elements.levelsGrid.innerHTML = chapter.levels.map(level => `
        <div class="chapter-card" data-level-id="${level.id}">
          <div class="chapter-number">${level.name}</div>
          <div class="chapter-title">${level.description}</div>
          <div class="chapter-stats">
            <span>5 frases</span>
            <span>${level.estimatedTime}</span>
          </div>
        </div>
      `).join('');

      document.querySelectorAll('.chapter-card').forEach(card => {
        card.addEventListener('click', () => {
          const levelId = parseInt(card.getAttribute('data-level-id'));
          const level = chapter.levels.find(l => l.id === levelId);
          if (level) {
            showPracticeModeMenu(level);
          }
        });
      });

      elements.levelMenu.classList.remove('hidden');
    }

    // Mostrar menu de modo de pr√°tica
    function showPracticeModeMenu(level) {
      hideAllScreens();
      currentState.currentLevel = level;
      elements.chapterPracticeTitle.textContent = `${level.name} - ${level.description}`;
      elements.practiceModeMenu.classList.remove('hidden');
    }

    // Iniciar pr√°tica
    function startPractice(mode) {
      currentState.currentMode = mode;
      currentState.currentQuestions = [...currentState.currentLevel.phrases];
      currentState.wrongAnswers = [];
      currentState.currentQuestionIndex = 0;
      currentState.correctCount = 0;
      currentState.wrongCount = 0;
      currentState.isReviewMode = false;
      currentState.currentAttempt = 1;
      showQuizScreen();
      loadQuestion();
    }

    // Mostrar tela de quiz
    function showQuizScreen() {
      hideAllScreens();
      elements.quizScreen.classList.remove('hidden');
      const modeName = currentState.currentMode === 'easy' ? 'F√°cil' : 'Dif√≠cil';
      elements.quizTitle.textContent = `Pr√°tica ${modeName}`;
      elements.quizSubtitle.textContent = currentState.currentMode === 'easy'
        ? 'Traduza do Ingl√™s para Portugu√™s'
        : 'Traduza do Portugu√™s para Ingl√™s';
    }

    // Carregar quest√£o
    function loadQuestion() {
      const question = currentState.currentQuestions[currentState.currentQuestionIndex];
      const totalQuestions = currentState.currentQuestions.length;
      elements.questionNumber.textContent = `Quest√£o ${currentState.currentQuestionIndex + 1} de ${totalQuestions}`;
      elements.questionStats.textContent = `Acertos: ${currentState.correctCount} | Erros: ${currentState.wrongCount}`;
      const progress = (currentState.currentQuestionIndex / totalQuestions) * 100;
      elements.progressBar.style.width = `${progress}%`;
      elements.questionText.textContent = currentState.currentMode === 'easy'
        ? question.english
        : question.portuguese;
      elements.answerInput.value = '';
      elements.feedbackArea.classList.add('hidden');
      elements.wordFeedbackArea.classList.add('hidden');
      elements.retryContainer.classList.add('hidden');
      elements.answerInput.focus();
      currentState.currentAttempt = 1;
    }

    // Pular quest√£o
    function skipQuestion() {
      currentState.wrongCount++;
      currentState.currentQuestionIndex++;
      if (currentState.currentQuestionIndex < currentState.currentQuestions.length) {
        loadQuestion();
      } else {
        showResults();
      }
    }

    // Verificar resposta
    function checkAnswer() {
      const userAnswer = elements.answerInput.value.trim();
      if (!userAnswer) return;
      const question = currentState.currentQuestions[currentState.currentQuestionIndex];
      const correctAnswers = [question.portuguese, ...question.alternativeTranslations];
      const isEasyMode = currentState.currentMode === 'easy';
      const analysis = analyzeAnswer(userAnswer, correctAnswers, isEasyMode);
      const isCorrect = analysis.isCorrect;
      showFeedback(isCorrect, correctAnswers[0], question, analysis);
      if (isCorrect || currentState.currentAttempt === 2) {
        if (isCorrect) {
          currentState.correctCount++;
        } else {
          currentState.wrongCount++;
          if (!currentState.isReviewMode) {
            currentState.wrongAnswers.push(question);
          }
        }
        elements.questionStats.textContent = `Acertos: ${currentState.correctCount} | Erros: ${currentState.wrongCount}`;
      }
    }

    // Fun√ß√µes de an√°lise
    function analyzeAnswer(userAnswer, correctAnswers, isEasyMode) {
      const normalizedUser = normalizeText(userAnswer);
      const normalizedCorrects = correctAnswers.map(ca => normalizeText(ca));
      for (const correct of normalizedCorrects) {
        if (normalizedUser === correct) {
          return { isCorrect: true, wordAnalysis: [] };
        }
      }
      const userWords = normalizedUser.split(/\s+/).filter(w => w);
      const correctWords = normalizedCorrects[0].split(/\s+/).filter(w => w);
      const wordAnalysis = [];
      const used = new Set();
      userWords.forEach(uw => {
        let best = null;
        correctWords.forEach((cw, i) => {
          if (!used.has(i)) {
            const sim = calculateSimilarity(uw, cw);
            if (sim > 0.6 && (!best || sim > best.similarity)) {
              best = { word: cw, index: i, similarity: sim };
            }
          }
        });
        if (best) {
          used.add(best.index);
          wordAnalysis.push({ userWord: uw, correctWord: best.word, status: uw === best.word ? 'correct' : 'wrong-position', position: best.index });
        } else {
          wordAnalysis.push({ userWord: uw, correctWord: null, status: 'incorrect', position: -1 });
        }
      });
      correctWords.forEach((cw, i) => {
        if (!used.has(i)) {
          wordAnalysis.push({ userWord: null, correctWord: cw, status: 'missing', position: i });
        }
      });
      wordAnalysis.sort((a, b) => a.position - b.position);
      return { isCorrect: false, wordAnalysis };
    }

    function normalizeText(text) {
      return text.toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/[.,?!;:'"()]/g, '')
        .replace(/\s+/g, ' ').trim();
    }

    function calculateSimilarity(w1, w2) {
      if (w1 === w2) return 1;
      if (w1.includes(w2) || w2.includes(w1)) return 0.8;
      const max = Math.max(w1.length, w2.length);
      let diff = 0;
      for (let i = 0; i < max; i++) {
        if (w1[i] !== w2[i]) diff++;
      }
      const sim = 1 - (diff / max);
      return sim > 0.7 ? sim : 0;
    }

    // Feedback
    function showFeedback(isCorrect, correctAnswer, question, analysis) {
      if (isCorrect) {
        elements.feedbackIcon.className = 'fas fa-check-circle';
        elements.feedbackTitle.textContent = 'Resposta Correta!';
        elements.feedbackIcon.style.color = 'var(--success)';
        elements.retryContainer.classList.add('hidden');
      } else {
        elements.feedbackIcon.className = 'fas fa-times-circle';
        elements.feedbackTitle.textContent = currentState.currentAttempt === 1 ? 'Quase l√°! Veja o feedback:' : 'Resposta Incorreta';
        elements.feedbackIcon.style.color = 'var(--error)';
        if (currentState.currentAttempt === 1 && analysis.wordAnalysis.length > 0) {
          showWordAnalysis(analysis.wordAnalysis);
          elements.retryContainer.classList.remove('hidden');
        } else {
          elements.wordFeedbackArea.classList.add('hidden');
          elements.retryContainer.classList.add('hidden');
        }
      }
      elements.correctAnswer.textContent = correctAnswer;
      generateVocabTable(question);
      elements.feedbackArea.classList.remove('hidden');
      if (!isCorrect) currentState.currentQuestionAnalysis = analysis;
    }

    function showWordAnalysis(wordAnalysis) {
      elements.wordFeedbackContent.innerHTML = '';
      wordAnalysis.forEach(item => {
        const bubble = document.createElement('div');
        bubble.className = `word-bubble word-${item.status}`;
        if (item.status === 'correct') {
          bubble.textContent = item.userWord;
          bubble.title = 'Palavra correta na posi√ß√£o certa';
        } else if (item.status === 'wrong-position') {
          bubble.textContent = item.userWord;
          bubble.title = `Palavra existe mas deveria estar em outra posi√ß√£o. Correta: "${item.correctWord}"`;
        } else if (item.status === 'incorrect') {
          bubble.textContent = item.userWord;
          bubble.title = 'Palavra n√£o existe na tradu√ß√£o correta';
        } else if (item.status === 'missing') {
          bubble.textContent = item.correctWord;
          bubble.title = 'Palavra faltando na sua resposta';
        }
        elements.wordFeedbackContent.appendChild(bubble);
      });
      elements.wordFeedbackArea.classList.remove('hidden');
    }

    function enableRetry() {
      currentState.currentAttempt = 2;
      elements.feedbackArea.classList.add('hidden');
      elements.answerInput.value = '';
      elements.answerInput.focus();
    }

    function generateVocabTable(question) {
      const enWords = question.english.split(' ').slice(0, 10);
      const ptWords = question.portuguese.split(' ').slice(0, 10);
      let html = '';
      const max = Math.max(enWords.length, ptWords.length);
      for (let i = 0; i < max; i++) {
        const en = enWords[i] || '';
        const pt = ptWords[i] || '';
        if (en.trim() || pt.trim()) {
          html += `<tr><td><strong>${en}</strong></td><td>${pt}</td></tr>`;
        }
      }
      elements.vocabTable.innerHTML = html || `<tr><td colspan="2" class="text-center">N√£o foi poss√≠vel gerar o vocabul√°rio.</td></tr>`;
    }

    // Pr√≥xima quest√£o
    function nextQuestion() {
      currentState.currentQuestionIndex++;
      if (currentState.currentQuestionIndex < currentState.currentQuestions.length) {
        loadQuestion();
      } else {
        if (!currentState.isReviewMode && currentState.wrongAnswers.length > 0) {
          currentState.isReviewMode = true;
          currentState.currentQuestions = [...currentState.wrongAnswers];
          currentState.currentQuestionIndex = 0;
          currentState.wrongAnswers = [];
          loadQuestion();
        } else {
          showResults();
        }
      }
    }

    // Resultados
    function showResults() {
      hideAllScreens();
      elements.resultsScreen.classList.remove('hidden');
      const total = currentState.currentLevel.phrases.length;
      const totalAttempts = currentState.correctCount + currentState.wrongCount;
      const correctPerc = totalAttempts ? Math.round((currentState.correctCount / totalAttempts) * 100) : 0;
      const completionPerc = Math.round((currentState.correctCount / total) * 100);
      elements.scoreCircle.style.background = `conic-gradient(var(--primary) ${correctPerc}%, var(--dark) 0%)`;
      elements.scoreValue.textContent = `${correctPerc}%`;
      if (completionPerc === 100) {
        elements.completionMessage.textContent = 'Parab√©ns! Dom√≠nio Total! üéâ';
        elements.completionMessage.style.color = 'var(--success)';
      } else if (completionPerc >= 80) {
        elements.completionMessage.textContent = 'Excelente! Quase Perfeito! üëè';
        elements.completionMessage.style.color = 'var(--success)';
      } else if (completionPerc >= 60) {
        elements.completionMessage.textContent = 'Bom Trabalho! Continue Assim! üí™';
        elements.completionMessage.style.color = 'var(--warning)';
      } else {
        elements.completionMessage.textContent = 'Continue Praticando! Voc√™ Consegue! üìö';
        elements.completionMessage.style.color = 'var(--error)';
      }
      elements.correctAnswers.textContent = currentState.correctCount;
      elements.wrongAnswers.textContent = currentState.wrongCount;
      elements.completionRate.textContent = `${completionPerc}%`;
      elements.resultsSubtitle.textContent = `Cap√≠tulo ${currentState.currentChapter.id.toString().padStart(3, '0')} - ${currentState.currentLevel.name}`;
    }

    // Esconder todas as telas
    function hideAllScreens() {
      elements.mainMenu.classList.add('hidden');
      elements.chaptersMenu.classList.add('hidden');
      elements.levelMenu.classList.add('hidden');
      elements.practiceModeMenu.classList.add('hidden');
      elements.quizScreen.classList.add('hidden');
      elements.resultsScreen.classList.add('hidden');
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>