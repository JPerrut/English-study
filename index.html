<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English Pro - Aprenda com Histórias</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #f59e0b;
      --secondary-dark: #d97706;
      --dark: #1e293b;
      --darker: #0f172a;
      --light: #f8fafc;
      --gray: #64748b;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--darker), #1e1b4b);
      color: var(--light);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }
    .container {
      width: 100%;
      max-width: 800px;
      background-color: rgba(30, 41, 59, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      padding: 24px;
      text-align: center;
      position: relative;
    }
    .header h1 {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 8px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .header p {
      font-size: 16px;
      opacity: 0.9;
    }
    .content {
      padding: 32px;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 16px 24px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
    }
    .btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .btn:hover::after {
      left: 100%;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
    }
    .btn-secondary {
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      color: var(--darker);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4);
    }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    .btn-small {
      padding: 12px 20px;
      font-size: 16px;
      width: auto;
      display: inline-block;
      margin-right: 12px;
    }
    .chapters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }
    .chapter-card {
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .chapter-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      border-color: var(--primary);
    }
    .chapter-number {
      font-size: 14px;
      color: var(--gray);
      margin-bottom: 8px;
    }
    .chapter-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .chapter-stats {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--gray);
    }
    .question-container {
      background: rgba(30, 41, 59, 0.7);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .question-number {
      font-size: 14px;
      color: var(--gray);
    }
    .progress-bar {
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    .progress {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transition: width 0.5s ease;
    }
    .question-text {
      font-size: 20px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 24px;
      line-height: 1.5;
      padding: 16px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 12px;
    }
    .input-container {
      margin-bottom: 24px;
    }
    .answer-input {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.5);
      color: white;
      font-size: 18px;
      transition: all 0.3s ease;
    }
    .answer-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }
    .feedback-container {
      background: rgba(15, 23, 42, 0.7);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border-left: 4px solid var(--primary);
    }
    .feedback-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .correct-answer {
      font-size: 18px;
      font-weight: 600;
      color: var(--success);
      margin-bottom: 16px;
      padding: 12px;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 8px;
    }
    .vocab-section {
      margin-top: 20px;
    }
    .vocab-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--secondary);
    }
    .vocab-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .vocab-table th, .vocab-table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .vocab-table th {
      color: var(--gray);
      font-weight: 500;
    }
    .word-feedback {
      margin: 16px 0;
      padding: 16px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 8px;
    }
    .word-feedback-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--secondary);
    }
    .word-feedback-content {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .word-bubble {
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }
    .word-correct {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      border: 1px solid var(--success);
    }
    .word-wrong-position {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
      border: 1px solid var(--warning);
    }
    .word-incorrect {
      background: rgba(239, 68, 68, 0.2);
      color: var(--error);
      border: 1px solid var(--error);
    }
    .word-missing {
      background: rgba(100, 116, 139, 0.2);
      color: var(--gray);
      border: 1px solid var(--gray);
      text-decoration: line-through;
    }
    .retry-container {
      text-align: center;
      margin-top: 20px;
      padding: 16px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 8px;
      border-left: 4px solid var(--warning);
    }
    .retry-message {
      font-size: 16px;
      margin-bottom: 12px;
      color: var(--warning);
    }
    .hidden {
      display: none !important;
    }
    .text-center {
      text-align: center;
    }
    .mt-4 {
      margin-top: 24px;
    }
    .mb-4 {
      margin-bottom: 24px;
    }
    .icon {
      margin-right: 8px;
    }
    .score-display {
      text-align: center;
      padding: 32px;
    }
    .score-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(var(--primary) 0%, var(--dark) 0%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      position: relative;
    }
    .score-circle::before {
      content: '';
      position: absolute;
      width: 100px;
      height: 100px;
      background: var(--darker);
      border-radius: 50%;
    }
    .score-value {
      position: relative;
      z-index: 1;
      font-size: 28px;
      font-weight: 700;
    }
    .completion-message {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      margin: 24px 0;
    }
    .stat {
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }
    .stat-label {
      font-size: 14px;
      color: var(--gray);
    }
    @media (max-width: 600px) {
      .content {
        padding: 20px;
      }
      .header h1 {
        font-size: 24px;
      }
      .question-text {
        font-size: 18px;
      }
      .btn {
        padding: 14px 20px;
        font-size: 16px;
      }
      .chapters-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Menu Principal -->
    <div id="main-menu">
      <div class="header">
        <h1><i class="fas fa-language icon"></i>English Pro</h1>
        <p>Aprenda inglês com suas histórias favoritas</p>
      </div>
      <div class="content">
        <button id="story-mode-btn" class="btn btn-primary">
          <i class="fas fa-book-open icon"></i>Inglês com História
        </button>
      </div>
    </div>
    <!-- Seleção de Capítulo -->
    <div id="chapters-menu" class="hidden">
      <div class="header">
        <button id="back-to-main" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1><i class="fas fa-book icon"></i>Capítulos</h1>
        <p>Selecione um capítulo para praticar</p>
      </div>
      <div class="content">
        <div class="chapters-grid" id="chapters-grid">
          <!-- Capítulos serão gerados dinamicamente -->
        </div>
      </div>
    </div>
    <!-- Seleção de Nível -->
    <div id="level-menu" class="hidden">
      <div class="header">
        <button id="back-to-chapters" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1 id="chapter-level-title">Capítulo </h1>
        <p>Escolha um nível para praticar</p>
      </div>
      <div class="content" id="levels-grid">
        <!-- Níveis serão gerados dinamicamente -->
      </div>
    </div>
    <!-- Seleção de Modo de Prática -->
    <div id="practice-mode-menu" class="hidden">
      <div class="header">
        <button id="back-to-levels" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1 id="chapter-practice-title">Nível </h1>
        <p>Selecione o modo de prática</p>
      </div>
      <div class="content">
        <button id="easy-practice-btn" class="btn btn-primary">
          <i class="fas fa-star icon"></i>Prática Fácil
          <br><small>Traduza do Inglês para Português</small>
        </button>
        <button id="hard-practice-btn" class="btn btn-secondary">
          <i class="fas fa-fire icon"></i>Prática Difícil
          <br><small>Traduza do Português para Inglês</small>
        </button>
      </div>
    </div>
    <!-- Tela de Questões -->
    <div id="quiz-screen" class="hidden">
      <div class="header">
        <button id="back-to-practice" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1 id="quiz-title">Prática</h1>
        <p id="quiz-subtitle">Traduza a frase abaixo</p>
      </div>
      <div class="content">
        <div class="question-container">
          <div class="question-header">
            <div class="question-number" id="question-number">Questão 1 de 5</div>
            <div class="question-stats" id="question-stats">Acertos: 0 | Erros: 0</div>
          </div>
          <div class="progress-bar">
            <div class="progress" id="progress-bar" style="width: 0%"></div>
          </div>
          <div class="question-text" id="question-text"></div>
          <div class="input-container">
            <input type="text" class="answer-input" id="answer-input" placeholder="Digite sua tradução aqui...">
          </div>
          <button id="submit-answer" class="btn btn-primary">Verificar Resposta</button>
          <button id="skip-button" class="btn btn-outline mt-4">Pular Frase</button>
        </div>
        <div id="feedback-area" class="feedback-container hidden">
          <div class="feedback-title">
            <i class="fas fa-info-circle" id="feedback-icon"></i>
            <span id="feedback-title-text">Feedback</span>
          </div>
          <div class="correct-answer" id="correct-answer"></div>
          <div id="word-feedback-area" class="word-feedback hidden">
            <div class="word-feedback-title">
              <i class="fas fa-spell-check icon"></i>Análise das Palavras:
            </div>
            <div class="word-feedback-content" id="word-feedback-content">
              <!-- Conteúdo gerado dinamicamente -->
            </div>
          </div>
          <div id="retry-container" class="retry-container hidden">
            <div class="retry-message">
              <i class="fas fa-redo-alt icon"></i>Tente novamente corrigindo as palavras destacadas
            </div>
            <button id="retry-button" class="btn btn-primary btn-small">Tentar Novamente</button>
          </div>
          <div class="vocab-section">
            <div class="vocab-title">
              <i class="fas fa-book icon"></i>Tradução das Palavras
            </div>
            <table class="vocab-table" id="vocab-table">
              <!-- Conteúdo gerado dinamicamente -->
            </table>
          </div>
          <button id="next-question" class="btn btn-primary mt-4">Próxima Questão</button>
        </div>
      </div>
    </div>
    <!-- Tela de Resultados -->
    <div id="results-screen" class="hidden">
      <div class="header">
        <h1><i class="fas fa-trophy icon"></i>Resultados</h1>
        <p id="results-subtitle">Desempenho no capítulo</p>
      </div>
      <div class="content">
        <div class="score-display">
          <div class="score-circle" id="score-circle">
            <div class="score-value" id="score-value">0%</div>
          </div>
          <div class="completion-message" id="completion-message">Parabéns!</div>
          <div class="stats">
            <div class="stat">
              <div class="stat-value" id="correct-answers">0</div>
              <div class="stat-label">Acertos</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="wrong-answers">0</div>
              <div class="stat-label">Erros</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="completion-rate">0%</div>
              <div class="stat-label">Concluído</div>
            </div>
          </div>
          <button id="restart-practice" class="btn btn-primary">Refazer Prática</button>
          <button id="back-to-chapters-from-results" class="btn btn-outline mt-4">Voltar aos Capítulos</button>
        </div>
      </div>
    </div>
  </div>
<script>
    // Dados organizados por capítulo e nível
  const CHAPTERS = [
  {
    id: 1,
    title: "Chapter 001",
    description: "Encontros no Trem",
    levels: [
      {
        id: 1,
        name: "Nível 1",
        description: "Encontros casuais",
        estimatedTime: "~1 minuto",
        phrases: [
          { 
            english: "That Girl Again.", 
            portuguese: "Aquela Garota de Novo.", 
            alternativeTranslations: [
              "Aquela garota outra vez.",
              "Aquela menina de novo."
            ],
            wordByWord: [
              { english: "That", portuguese: "Aquela" },
              { english: "Girl", portuguese: "Garota" },
              { english: "Again", portuguese: "de Novo" }
            ]
          },
          { 
            english: "I've run into her here several times already.", 
            portuguese: "Eu já cruzei com ela aqui várias vezes.", 
            alternativeTranslations: [
              "Já encontrei ela aqui várias vezes.",
              "Eu já me deparei com ela aqui várias vezes."
            ],
            wordByWord: [
              { english: "I've", portuguese: "Eu" },
              { english: "run into", portuguese: "cruzei com" },
              { english: "her", portuguese: "ela" },
              { english: "here", portuguese: "aqui" },
              { english: "several times", portuguese: "várias vezes" },
              { english: "already", portuguese: "já" }
            ]
          },
          { 
            english: "She's going late again today.", 
            portuguese: "Ela está indo tarde de novo hoje.", 
            alternativeTranslations: [
              "Ela está saindo tarde outra vez hoje.",
              "Hoje ela está atrasada de novo."
            ],
            wordByWord: [
              { english: "She's", portuguese: "Ela está" },
              { english: "going", portuguese: "indo" },
              { english: "late", portuguese: "tarde" },
              { english: "again", portuguese: "de novo" },
              { english: "today", portuguese: "hoje" }
            ]
          },
          { 
            english: "That person and I today too.", 
            portuguese: "Aquela pessoa e eu hoje também.", 
            alternativeTranslations: [
              "Eu e aquela pessoa hoje também.",
              "Aquela pessoa e eu, hoje de novo."
            ],
            wordByWord: [
              { english: "That", portuguese: "Aquela" },
              { english: "person", portuguese: "pessoa" },
              { english: "and", portuguese: "e" },
              { english: "I", portuguese: "eu" },
              { english: "today", portuguese: "hoje" },
              { english: "too", portuguese: "também" }
            ]
          },
          { 
            english: "We will take the same last train.", 
            portuguese: "Nós vamos pegar o mesmo último trem.", 
            alternativeTranslations: [
              "Vamos pegar o mesmo último trem.",
              "Pegaremos o mesmo último trem."
            ],
            wordByWord: [
              { english: "We", portuguese: "Nós" },
              { english: "will take", portuguese: "vamos pegar" },
              { english: "the same", portuguese: "o mesmo" },
              { english: "last", portuguese: "último" },
              { english: "train", portuguese: "trem" }
            ]
          }
        ]
      },
      {
        id: 2,
        name: "Nível 2",
        description: "Pensamentos e curiosidades",
        estimatedTime: "~1 minuto",
        phrases: [
          { 
            english: "Or maybe she's in a band?", 
            portuguese: "Ou talvez ela esteja em uma banda?", 
            alternativeTranslations: [
              "Ou será que toca numa banda?",
              "Ou talvez participe de um grupo musical?"
            ],
            wordByWord: [
              { english: "Or", portuguese: "Ou" },
              { english: "maybe", portuguese: "talvez" },
              { english: "she's", portuguese: "ela esteja" },
              { english: "in", portuguese: "em" },
              { english: "a", portuguese: "uma" },
              { english: "band", portuguese: "banda" }
            ]
          },
          { 
            english: "Ah! We made eye contact!", 
            portuguese: "Ah! Nós fizemos contato visual!", 
            alternativeTranslations: [
              "Ah! Nossos olhos se encontraram!",
              "Ah! Ela me olhou!"
            ],
            wordByWord: [
              { english: "Ah!", portuguese: "Ah!" },
              { english: "We", portuguese: "Nós" },
              { english: "made", portuguese: "fizemos" },
              { english: "eye contact", portuguese: "contato visual" }
            ]
          },
          { 
            english: "I was lost in thought and stared... like a pervert...!!", 
            portuguese: "Eu estava perdido em pensamentos e encarei... como um pervertido...!!", 
            alternativeTranslations: [
              "Estava distraído e fiquei encarando... que nem um pervertido...!!",
              "Viajei nos pensamentos e fiquei olhando... igual um tarado...!!"
            ],
            wordByWord: [
              { english: "I was", portuguese: "Eu estava" },
              { english: "lost in", portuguese: "perdido em" },
              { english: "thought", portuguese: "pensamentos" },
              { english: "and", portuguese: "e" },
              { english: "stared", portuguese: "encarei" },
              { english: "like", portuguese: "como" },
              { english: "a", portuguese: "um" },
              { english: "pervert", portuguese: "pervertido" }
            ]
          },
          { 
            english: "Even though we run into each other here often...", 
            portuguese: "Embora a gente se encontre aqui frequentemente...", 
            alternativeTranslations: [
              "Apesar de nos encontrarmos aqui com frequência...",
              "Mesmo nos cruzando aqui sempre..."
            ],
            wordByWord: [
              { english: "Even though", portuguese: "Embora" },
              { english: "we", portuguese: "a gente" },
              { english: "run into", portuguese: "se encontre" },
              { english: "each other", portuguese: "um ao outro" },
              { english: "here", portuguese: "aqui" },
              { english: "often", portuguese: "frequentemente" }
            ]
          },
          { 
            english: "I guess it's only me who's aware of it.", 
            portuguese: "Eu acho que sou só eu que estou ciente disso.", 
            alternativeTranslations: [
              "Acho que só eu percebi isso.",
              "Creio que só eu notei isso."
            ],
            wordByWord: [
              { english: "I guess", portuguese: "Eu acho" },
              { english: "it's", portuguese: "que é" },
              { english: "only me", portuguese: "só eu" },
              { english: "who's", portuguese: "que estou" },
              { english: "aware of", portuguese: "ciente de" },
              { english: "it", portuguese: "isso" }
            ]
          }
        ]
      },
      {
        id: 3,
        name: "Nível 3",
        description: "Reflexões e coincidências",
        estimatedTime: "~1 minuto",
        phrases: [
          { 
            english: "Things like this are just coincidences, not fate.", 
            portuguese: "Coisas como essa são apenas coincidências, não destino.", 
            alternativeTranslations: [
              "Essas coisas são só coincidências, não destino.",
              "Situações assim são meras coincidências, não sina do destino."
            ],
            wordByWord: [
              { english: "Things", portuguese: "Coisas" },
              { english: "like this", portuguese: "como essa" },
              { english: "are", portuguese: "são" },
              { english: "just", portuguese: "apenas" },
              { english: "coincidences", portuguese: "coincidências" },
              { english: "not", portuguese: "não" },
              { english: "fate", portuguese: "destino" }
            ]
          },
          { 
            english: "Ah... I can't concentrate on reading either.", 
            portuguese: "Ah... Eu não consigo me concentrar na leitura também.", 
            alternativeTranslations: [
              "Ah... Também não consigo focar na leitura.",
              "Ah... Nem pra ler eu consigo me concentrar."
            ],
            wordByWord: [
              { english: "Ah...", portuguese: "Ah..." },
              { english: "I", portuguese: "Eu" },
              { english: "can't", portuguese: "não consigo" },
              { english: "concentrate on", portuguese: "me concentrar na" },
              { english: "reading", portuguese: "leitura" },
              { english: "either", portuguese: "também" }
            ]
          },
          { 
            english: "Let's Listen to music.", 
            portuguese: "Vamos ouvir música.", 
            alternativeTranslations: [
              "Bora ouvir música.",
              "Vamos escutar um som."
            ],
            wordByWord: [
              { english: "Let's", portuguese: "Vamos" },
              { english: "Listen to", portuguese: "ouvir" },
              { english: "music", portuguese: "música" }
            ]
          },
          { 
            english: "Should I listen to this song again today?", 
            portuguese: "Devo ouvir esta música de novo hoje?", 
            alternativeTranslations: [
              "Será que ouço essa música outra vez hoje?",
              "Será que devo escutar essa música novamente hoje?"
            ],
            wordByWord: [
              { english: "Should I", portuguese: "Devo" },
              { english: "listen to", portuguese: "ouvir" },
              { english: "this", portuguese: "esta" },
              { english: "song", portuguese: "música" },
              { english: "again", portuguese: "de novo" },
              { english: "today", portuguese: "hoje" }
            ]
          },
          { 
            english: "The intro of this song is the best!", 
            portuguese: "A introdução desta música é a melhor!", 
            alternativeTranslations: [
              "A intro dessa música é incrível!",
              "O começo dessa música é o máximo!"
            ],
            wordByWord: [
              { english: "The", portuguese: "A" },
              { english: "intro", portuguese: "introdução" },
              { english: "of", portuguese: "de" },
              { english: "this", portuguese: "esta" },
              { english: "song", portuguese: "música" },
              { english: "is", portuguese: "é" },
              { english: "the best", portuguese: "a melhor" }
            ]
          }
        ]
      }
    ]
  },
  {
    id: 2,
    title: "Chapter 002",
    description: "A Música e os Fones",
    levels: [
      {
        id: 1,
        name: "Nível 1",
        description: "Apreciação musical",
        estimatedTime: "~1 minuto",
        phrases: [
          { 
            english: "The first verse is so good too!", 
            portuguese: "O primeiro verso é tão bom também!", 
            alternativeTranslations: [
              "A primeira parte é muito boa também!",
              "O começo da letra é ótimo também!"
            ],
            wordByWord: [
              { english: "The", portuguese: "O" },
              { english: "first", portuguese: "primeiro" },
              { english: "verse", portuguese: "verso" },
              { english: "is", portuguese: "é" },
              { english: "so good", portuguese: "tão bom" },
              { english: "too", portuguese: "também" }
            ]
          },
          { 
            english: "It's such a great song...", 
            portuguese: "É uma música tão ótima...", 
            alternativeTranslations: [
              "É uma canção tão boa...",
              "Que música fantástica..."
            ],
            wordByWord: [
              { english: "It's", portuguese: "É" },
              { english: "such a", portuguese: "uma" },
              { english: "great", portuguese: "tão ótima" },
              { english: "song", portuguese: "música" }
            ]
          },
          { 
            english: "But hardly anyone knows it...", 
            portuguese: "Mas quase ninguém a conhece...", 
            alternativeTranslations: [
              "Mas praticamente ninguém conhece...",
              "Porém quase ninguém sabe dela...",
              "Mas quase ninguém conhece"
            ],
            wordByWord: [
              { english: "But", portuguese: "Mas" },
              { english: "hardly anyone", portuguese: "quase ninguém" },
              { english: "knows", portuguese: "conhece" },
              { english: "it", portuguese: "a" }
            ]
          },
          { 
            english: "I wish there were someone to talk to about this song...", 
            portuguese: "Eu queria que houvesse alguém para conversar sobre esta música...", 
            alternativeTranslations: [
              "Queria ter alguém pra conversar sobre essa música...",
              "Desejava que existisse alguém para falar sobre essa canção..."
            ],
            wordByWord: [
              { english: "I wish", portuguese: "Eu queria" },
              { english: "there were", portuguese: "que houvesse" },
              { english: "someone", portuguese: "alguém" },
              { english: "to talk to", portuguese: "para conversar" },
              { english: "about", portuguese: "sobre" },
              { english: "this", portuguese: "esta" },
              { english: "song", portuguese: "música" }
            ]
          },
          { 
            english: "and about the long afternoon too...", 
            portuguese: "e sobre a longa tarde, também...", 
            alternativeTranslations: [
              "e também sobre a tarde longa...",
              "e sobre a longa tarde também..."
            ],
            wordByWord: [
              { english: "and", portuguese: "e" },
              { english: "about", portuguese: "sobre" },
              { english: "the", portuguese: "a" },
              { english: "long", portuguese: "longa" },
              { english: "afternoon", portuguese: "tarde" },
              { english: "too", portuguese: "também" }
            ]
          }
        ]
      },
      {
        id: 2,
        name: "Nível 2",
        description: "Problemas técnicos",
        estimatedTime: "~1 minuto",
        phrases: [
          { 
            english: "huh? But why does it sound muffled today?", 
            portuguese: "Hã? Mas por que está abafado hoje?", 
            alternativeTranslations: [
              "Hã? Mas por que está embolado hoje?",
              "Hein? Mas por que está abafado hoje?"
            ],
            wordByWord: [
              { english: "huh?", portuguese: "Hã?" },
              { english: "But", portuguese: "Mas" },
              { english: "why", portuguese: "por que" },
              { english: "does it", portuguese: "está" },
              { english: "sound", portuguese: "" },
              { english: "muffled", portuguese: "abafado" },
              { english: "today", portuguese: "hoje" }
            ]
          },
          { 
            english: "Did the cheap earphones break already?", 
            portuguese: "Os fones de ouvido baratos já quebraram?", 
            alternativeTranslations: [
              "Os fones baratos já pifaram?",
              "Os fones de ouvido econômicos já estragaram?"
            ],
            wordByWord: [
              { english: "Did", portuguese: "" },
              { english: "the", portuguese: "Os" },
              { english: "cheap", portuguese: "baratos" },
              { english: "earphones", portuguese: "fones de ouvido" },
              { english: "break", portuguese: "quebraram" },
              { english: "already", portuguese: "já" }
            ]
          },
          { 
            english: "Should I turn up the volume a little more...", 
            portuguese: "Devo aumentar o volume um pouco mais...", 
            alternativeTranslations: [
              "Será que aumento o volume mais um pouco...",
              "Devo botar o volume mais alto..."
            ],
            wordByWord: [
              { english: "Should I", portuguese: "Devo" },
              { english: "turn up", portuguese: "aumentar" },
              { english: "the", portuguese: "o" },
              { english: "volume", portuguese: "volume" },
              { english: "a little", portuguese: "um pouco" },
              { english: "more", portuguese: "mais" }
            ]
          },
          { 
            english: "Excuse me!", 
            portuguese: "Com licença!", 
            alternativeTranslations: [
              "Licença!",
              "Perdão!"
            ],
            wordByWord: [
              { english: "Excuse", portuguese: "Com" },
              { english: "me", portuguese: "licença" }
            ]
          },
          { 
            english: "could you turn down your phone's volume?", 
            portuguese: "Você poderia abaixar o volume do seu celular?", 
            alternativeTranslations: [
              "pode baixar o volume do seu celular?",
              "dá pra diminuir o volume do seu telefone?"
            ],
            wordByWord: [
              { english: "could you", portuguese: "Você poderia" },
              { english: "turn down", portuguese: "abaixar" },
              { english: "your", portuguese: "o" },
              { english: "phone's", portuguese: "do seu celular" },
              { english: "volume", portuguese: "volume" }
            ]
          }
        ]
      },
      {
        id: 3,
        name: "Nível 3",
        description: "Interações inesperadas",
        estimatedTime: "~1 minuto",
        phrases: [
          { 
            english: "I can hear it from over there!", 
            portuguese: "Eu consigo ouvir daqui!", 
            alternativeTranslations: [
              "Estou ouvindo daqui!",
              "Dá pra ouvir daqui!"
            ],
            wordByWord: [
              { english: "I", portuguese: "Eu" },
              { english: "can hear", portuguese: "consigo ouvir" },
              { english: "it", portuguese: "" },
              { english: "from over there", portuguese: "daqui" }
            ]
          },
          { 
            english: "Ah! The earphones weren't paired!", 
            portuguese: "Ah! Os fones de ouvido não estavam pareados!", 
            alternativeTranslations: [
              "Ah! Os fones não estavam conectados!",
              "Ah! Os fones não tinham sido emparelhados!"
            ],
            wordByWord: [
              { english: "Ah!", portuguese: "Ah!" },
              { english: "The", portuguese: "Os" },
              { english: "earphones", portuguese: "fones de ouvido" },
              { english: "weren't", portuguese: "não estavam" },
              { english: "paired", portuguese: "pareados" }
            ]
          },
          { 
            english: "These cheap earphones again...!!", 
            portuguese: "Estes fones de ouvido baratos de novo...!!", 
            alternativeTranslations: [
              "Esses fones baratos outra vez...!!",
              "Esses fones vagabundos de novo...!!"
            ],
            wordByWord: [
              { english: "These", portuguese: "Estes" },
              { english: "cheap", portuguese: "baratos" },
              { english: "earphones", portuguese: "fones de ouvido" },
              { english: "again", portuguese: "de novo" }
            ]
          },
          { 
            english: "Do you like that song?", 
            portuguese: "Você gosta daquela música?", 
            alternativeTranslations: [
              "Gosta dessa música?",
              "Você curte essa música?"
            ],
            wordByWord: [
              { english: "Do you", portuguese: "Você" },
              { english: "like", portuguese: "gosta" },
              { english: "that", portuguese: "daquela" },
              { english: "song", portuguese: "música" }
            ]
          },
          { 
            english: "That song from the Long Afternoon", 
            portuguese: "Aquela música da 'Long Afternoon'", 
            alternativeTranslations: [
              "Aquela música do Long Afternoon",
              "Aquela canção da Long Afternoon"
            ],
            wordByWord: [
              { english: "That", portuguese: "Aquela" },
              { english: "song", portuguese: "música" },
              { english: "from", portuguese: "da" },
              { english: "the", portuguese: "" },
              { english: "Long Afternoon", portuguese: "'Long Afternoon'" }
            ]
          }
        ]
      }
    ]
  }
];

    // Sistema de sinônimos
    const SYNONYMS = {
      // Português
      'este': ['esse', 'aquele'],
      'esta': ['essa', 'aquela'],
      'estes': ['esses', 'aqueles'],
      'estas': ['essas', 'aquelas'],
      'meu': ['minha'],
      'teu': ['tua'],
      'seu': ['sua'],
      'nosso': ['nossa'],
      'vosso': ['vossa'],
      'grande': ['enorme', 'gigante', 'imenso'],
      'pequeno': ['pequena', 'mini', 'minúsculo'],
      'bom': ['boa', 'ótimo', 'ótima', 'excelente'],
      'mau': ['ruim', 'péssimo', 'horrível'],
      'bonito': ['belo', 'lindo', 'formoso'],
      'feio': ['horrível', 'desagradável'],
      'feliz': ['alegre', 'contente'],
      'triste': ['infeliz', 'desolado'],
      'rápido': ['veloz', 'ligeiro'],
      'lento': ['devagar'],
      'caro': ['custoso', 'dispendioso'],
      'barato': ['econômico', 'acessível'],
      'fácil': ['simples'],
      'difícil': ['complicado', 'complexo'],
      'novo': ['nova', 'recente'],
      'velho': ['antigo', 'idoso'],
      'jovem': ['moço', 'adolescente'],
      'criança': ['menino', 'menina', 'garoto', 'garota'],
      'homem': ['senhor', 'rapaz'],
      'mulher': ['senhora', 'moça', 'dona'],
      'casa': ['residência', 'lar', 'moradia'],
      'carro': ['automóvel', 'veículo'],
      'trabalho': ['emprego', 'serviço'],
      'dinheiro': ['grana', 'verba'],
      'tempo': ['clima'],
      'dia': ['data'],
      'noite': ['madrugada'],
      'amanhã': ['dia seguinte'],
      'ontem': ['dia anterior'],
      'hoje': ['agora', 'atualmente'],
      'sempre': ['constantemente'],
      'nunca': ['jamais'],
      'talvez': ['possivelmente'],
      'com certeza': ['certamente', 'com certeza'],
      'obrigado': ['agradecido', 'grato'],
      'de nada': ['disponha', 'não há de quê'],
      'por favor': ['se faz favor', 'faça o favor'],
      'desculpe': ['perdão', 'me desculpe'],
      'com licença': ['licença'],
      
      // Inglês
      'this': ['that'],
      'these': ['those'],
      'happy': ['glad', 'joyful'],
      'sad': ['unhappy', 'miserable'],
      'big': ['large', 'huge'],
      'small': ['little', 'tiny'],
      'good': ['great', 'excellent'],
      'bad': ['terrible', 'awful'],
      'beautiful': ['pretty', 'lovely'],
      'ugly': ['unattractive'],
      'fast': ['quick', 'rapid'],
      'slow': ['sluggish'],
      'expensive': ['costly'],
      'cheap': ['inexpensive'],
      'easy': ['simple'],
      'hard': ['difficult', 'tough'],
      'new': ['recent'],
      'old': ['elderly', 'aged'],
      'young': ['youthful'],
      'child': ['kid', 'boy', 'girl'],
      'man': ['gentleman', 'guy'],
      'woman': ['lady', 'girl'],
      'house': ['home', 'residence'],
      'car': ['vehicle', 'automobile'],
      'work': ['job', 'employment'],
      'money': ['cash', 'currency'],
      'time': ['period'],
      'day': ['date'],
      'night': ['evening'],
      'tomorrow': ['next day'],
      'yesterday': ['previous day'],
      'today': ['now', 'currently'],
      'always': ['constantly'],
      'never': ['ever'],
      'maybe': ['perhaps', 'possibly'],
      'sure': ['certainly', 'definitely'],
      'thank you': ['thanks'],
      'you are welcome': ['welcome', 'my pleasure'],
      'please': ['if you please'],
      'sorry': ['apologies', 'excuse me'],
      'excuse me': ['pardon me']
    };

    // Estado do aplicativo
    let currentState = {
      currentChapter: null,
      currentLevel: null,
      currentMode: null,
      currentQuestions: [],
      wrongAnswers: [],
      currentQuestionIndex: 0,
      correctCount: 0,
      wrongCount: 0,
      isReviewMode: false,
      currentAttempt: 1,
      currentQuestionAnalysis: null
    };

    // Elementos DOM
    const elements = {
      // Telas
      mainMenu: document.getElementById('main-menu'),
      chaptersMenu: document.getElementById('chapters-menu'),
      levelMenu: document.getElementById('level-menu'),
      practiceModeMenu: document.getElementById('practice-mode-menu'),
      quizScreen: document.getElementById('quiz-screen'),
      resultsScreen: document.getElementById('results-screen'),
      // Botões de navegação
      storyModeBtn: document.getElementById('story-mode-btn'),
      backToMain: document.getElementById('back-to-main'),
      backToChapters: document.getElementById('back-to-chapters'),
      backToLevels: document.getElementById('back-to-levels'),
      backToPractice: document.getElementById('back-to-practice'),
      backToChaptersFromResults: document.getElementById('back-to-chapters-from-results'),
      // Elementos do quiz
      chapterLevelTitle: document.getElementById('chapter-level-title'),
      chapterPracticeTitle: document.getElementById('chapter-practice-title'),
      quizTitle: document.getElementById('quiz-title'),
      quizSubtitle: document.getElementById('quiz-subtitle'),
      questionNumber: document.getElementById('question-number'),
      questionStats: document.getElementById('question-stats'),
      progressBar: document.getElementById('progress-bar'),
      questionText: document.getElementById('question-text'),
      answerInput: document.getElementById('answer-input'),
      submitAnswer: document.getElementById('submit-answer'),
      skipButton: document.getElementById('skip-button'),
      // Elementos de feedback
      feedbackArea: document.getElementById('feedback-area'),
      feedbackIcon: document.getElementById('feedback-icon'),
      feedbackTitle: document.getElementById('feedback-title-text'),
      correctAnswer: document.getElementById('correct-answer'),
      vocabTable: document.getElementById('vocab-table'),
      nextQuestion: document.getElementById('next-question'),
      wordFeedbackArea: document.getElementById('word-feedback-area'),
      wordFeedbackContent: document.getElementById('word-feedback-content'),
      retryContainer: document.getElementById('retry-container'),
      retryButton: document.getElementById('retry-button'),
      // Elementos de resultados
      resultsSubtitle: document.getElementById('results-subtitle'),
      scoreCircle: document.getElementById('score-circle'),
      scoreValue: document.getElementById('score-value'),
      completionMessage: document.getElementById('completion-message'),
      correctAnswers: document.getElementById('correct-answers'),
      wrongAnswers: document.getElementById('wrong-answers'),
      completionRate: document.getElementById('completion-rate'),
      restartPractice: document.getElementById('restart-practice'),
      // Grids
      chaptersGrid: document.getElementById('chapters-grid'),
      levelsGrid: document.getElementById('levels-grid'),
      // Botões de modo de prática
      easyPracticeBtn: document.getElementById('easy-practice-btn'),
      hardPracticeBtn: document.getElementById('hard-practice-btn')
    };

    // Inicialização
    function init() {
      // Garante que apenas o menu principal está visível no início
      hideAllScreens();
      elements.mainMenu.classList.remove('hidden');
      
      renderChaptersGrid();
      attachEventListeners();
    }

    // Anexar event listeners
    function attachEventListeners() {
      elements.storyModeBtn.addEventListener('click', showChaptersMenu);
      elements.backToMain.addEventListener('click', showMainMenu);
      elements.backToChapters.addEventListener('click', showChaptersMenu);
      elements.backToLevels.addEventListener('click', () => {
        if (currentState.currentChapter) {
          showLevelMenu(currentState.currentChapter);
        }
      });
      elements.backToPractice.addEventListener('click', () => {
        if (currentState.currentLevel) {
          showPracticeModeMenu(currentState.currentLevel);
        }
      });
      elements.backToChaptersFromResults.addEventListener('click', showChaptersMenu);
      elements.easyPracticeBtn.addEventListener('click', () => startPractice('easy'));
      elements.hardPracticeBtn.addEventListener('click', () => startPractice('hard'));
      elements.submitAnswer.addEventListener('click', checkAnswer);
      elements.skipButton.addEventListener('click', skipQuestion);
      elements.nextQuestion.addEventListener('click', nextQuestion);
      elements.retryButton.addEventListener('click', enableRetry);
      elements.answerInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          if (elements.feedbackArea.classList.contains('hidden')) {
            checkAnswer();
          } else if (!elements.retryContainer.classList.contains('hidden')) {
            enableRetry();
          } else {
            nextQuestion();
          }
        }
      });
      elements.restartPractice.addEventListener('click', () => {
        startPractice(currentState.currentMode);
      });
    }

    // Funções de navegação
    function showMainMenu() {
      hideAllScreens();
      elements.mainMenu.classList.remove('hidden');
    }

    function showChaptersMenu() {
      hideAllScreens();
      elements.chaptersMenu.classList.remove('hidden');
    }

    // Renderizar capítulos
    function renderChaptersGrid() {
      elements.chaptersGrid.innerHTML = CHAPTERS.map(chapter => `
        <div class="chapter-card" data-chapter-id="${chapter.id}">
          <div class="chapter-number">Capítulo ${chapter.id.toString().padStart(3, '0')}</div>
          <div class="chapter-title">${chapter.title}</div>
          <div class="chapter-stats">
            <span>3 níveis</span>
            <span><i class="fas fa-star"></i> ${chapter.id}.0</span>
          </div>
        </div>
      `).join('');

      document.querySelectorAll('.chapter-card').forEach(card => {
        card.addEventListener('click', () => {
          const chapterId = parseInt(card.getAttribute('data-chapter-id'));
          const chapter = CHAPTERS.find(c => c.id === chapterId);
          if (chapter) {
            showLevelMenu(chapter);
          }
        });
      });
    }

    // Mostrar menu de níveis
    function showLevelMenu(chapter) {
      hideAllScreens();
      currentState.currentChapter = chapter;
      elements.chapterLevelTitle.textContent = `Capítulo ${chapter.id.toString().padStart(3, '0')} - ${chapter.title}`;
      elements.levelsGrid.innerHTML = chapter.levels.map(level => `
        <div class="chapter-card" data-level-id="${level.id}">
          <div class="chapter-number">${level.name}</div>
          <div class="chapter-title">${level.description}</div>
          <div class="chapter-stats">
            <span>5 frases</span>
            <span>${level.estimatedTime}</span>
          </div>
        </div>
      `).join('');

      document.querySelectorAll('.chapter-card').forEach(card => {
        card.addEventListener('click', () => {
          const levelId = parseInt(card.getAttribute('data-level-id'));
          const level = chapter.levels.find(l => l.id === levelId);
          if (level) {
            showPracticeModeMenu(level);
          }
        });
      });

      elements.levelMenu.classList.remove('hidden');
    }

    // Mostrar menu de modo de prática
    function showPracticeModeMenu(level) {
      hideAllScreens();
      currentState.currentLevel = level;
      elements.chapterPracticeTitle.textContent = `${level.name} - ${level.description}`;
      elements.practiceModeMenu.classList.remove('hidden');
    }

    // Iniciar prática
    function startPractice(mode) {
      currentState.currentMode = mode;
      currentState.currentQuestions = [...currentState.currentLevel.phrases];
      currentState.wrongAnswers = [];
      currentState.currentQuestionIndex = 0;
      currentState.correctCount = 0;
      currentState.wrongCount = 0;
      currentState.isReviewMode = false;
      currentState.currentAttempt = 1;
      showQuizScreen();
      loadQuestion();
    }

    // Mostrar tela de quiz
    function showQuizScreen() {
      hideAllScreens();
      elements.quizScreen.classList.remove('hidden');
      const modeName = currentState.currentMode === 'easy' ? 'Fácil' : 'Difícil';
      elements.quizTitle.textContent = `Prática ${modeName}`;
      elements.quizSubtitle.textContent = currentState.currentMode === 'easy'
        ? 'Traduza do Inglês para Português'
        : 'Traduza do Português para Inglês';
    }

    // Carregar questão
    function loadQuestion() {
      const question = currentState.currentQuestions[currentState.currentQuestionIndex];
      const totalQuestions = currentState.currentQuestions.length;
      elements.questionNumber.textContent = `Questão ${currentState.currentQuestionIndex + 1} de ${totalQuestions}`;
      elements.questionStats.textContent = `Acertos: ${currentState.correctCount} | Erros: ${currentState.wrongCount}`;
      const progress = (currentState.currentQuestionIndex / totalQuestions) * 100;
      elements.progressBar.style.width = `${progress}%`;
      elements.questionText.textContent = currentState.currentMode === 'easy'
        ? question.english
        : question.portuguese;
      elements.answerInput.value = '';
      elements.feedbackArea.classList.add('hidden');
      elements.wordFeedbackArea.classList.add('hidden');
      elements.retryContainer.classList.add('hidden');
      elements.answerInput.focus();
      currentState.currentAttempt = 1;
    }

    // Pular questão
    function skipQuestion() {
      currentState.wrongCount++;
      currentState.currentQuestionIndex++;
      if (currentState.currentQuestionIndex < currentState.currentQuestions.length) {
        loadQuestion();
      } else {
        showResults();
      }
    }

    // Verificar resposta
    function checkAnswer() {
      const userAnswer = elements.answerInput.value.trim();
      if (!userAnswer) return;
      const question = currentState.currentQuestions[currentState.currentQuestionIndex];
      const correctAnswers = [question.portuguese, ...question.alternativeTranslations];
      const isEasyMode = currentState.currentMode === 'easy';
      const analysis = analyzeAnswer(userAnswer, correctAnswers, isEasyMode);
      const isCorrect = analysis.isCorrect;
      showFeedback(isCorrect, correctAnswers[0], question, analysis);
      if (isCorrect || currentState.currentAttempt === 2) {
        if (isCorrect) {
          currentState.correctCount++;
        } else {
          currentState.wrongCount++;
          if (!currentState.isReviewMode) {
            currentState.wrongAnswers.push(question);
          }
        }
        elements.questionStats.textContent = `Acertos: ${currentState.correctCount} | Erros: ${currentState.wrongCount}`;
      }
    }

    // Funções de análise
    function analyzeAnswer(userAnswer, correctAnswers, isEasyMode) {
      const normalizedUser = normalizeText(userAnswer);
      const normalizedCorrects = correctAnswers.map(ca => normalizeText(ca));
      
      // Verifica se a resposta é exatamente igual a alguma tradução correta
      for (const correct of normalizedCorrects) {
        if (normalizedUser === correct) {
          return { isCorrect: true, wordAnalysis: [] };
        }
      }

      // Se não for exata, verifica usando sinônimos
      for (const correct of normalizedCorrects) {
        if (checkWithSynonyms(normalizedUser, correct)) {
          return { isCorrect: true, wordAnalysis: [] };
        }
      }

      // Análise palavra por palavra
      const userWords = normalizedUser.split(/\s+/).filter(w => w);
      const correctWords = normalizedCorrects[0].split(/\s+/).filter(w => w);
      const wordAnalysis = [];
      const used = new Set();
      
      userWords.forEach(uw => {
        let best = null;
        correctWords.forEach((cw, i) => {
          if (!used.has(i)) {
            const sim = calculateSimilarityWithSynonyms(uw, cw);
            if (sim > 0.6 && (!best || sim > best.similarity)) {
              best = { word: cw, index: i, similarity: sim };
            }
          }
        });
        if (best) {
          used.add(best.index);
          const status = (uw === best.word || areSynonyms(uw, best.word)) ? 'correct' : 'wrong-position';
          wordAnalysis.push({ userWord: uw, correctWord: best.word, status: status, position: best.index });
        } else {
          wordAnalysis.push({ userWord: uw, correctWord: null, status: 'incorrect', position: -1 });
        }
      });
      
      correctWords.forEach((cw, i) => {
        if (!used.has(i)) {
          wordAnalysis.push({ userWord: null, correctWord: cw, status: 'missing', position: i });
        }
      });
      
      wordAnalysis.sort((a, b) => a.position - b.position);
      return { isCorrect: false, wordAnalysis };
    }

    function checkWithSynonyms(userAnswer, correctAnswer) {
      const userWords = userAnswer.split(/\s+/);
      const correctWords = correctAnswer.split(/\s+/);
      
      if (userWords.length !== correctWords.length) return false;
      
      for (let i = 0; i < userWords.length; i++) {
        if (userWords[i] !== correctWords[i] && !areSynonyms(userWords[i], correctWords[i])) {
          return false;
        }
      }
      return true;
    }

    function areSynonyms(word1, word2) {
      if (word1 === word2) return true;
      
      // Verifica nos sinônimos em português
      if (SYNONYMS[word1] && SYNONYMS[word1].includes(word2)) return true;
      if (SYNONYMS[word2] && SYNONYMS[word2].includes(word1)) return true;
      
      return false;
    }

    function calculateSimilarityWithSynonyms(w1, w2) {
      if (w1 === w2) return 1;
      if (areSynonyms(w1, w2)) return 0.9;
      if (w1.includes(w2) || w2.includes(w1)) return 0.8;
      
      const max = Math.max(w1.length, w2.length);
      let diff = 0;
      for (let i = 0; i < max; i++) {
        if (w1[i] !== w2[i]) diff++;
      }
      const sim = 1 - (diff / max);
      return sim > 0.7 ? sim : 0;
    }

    function normalizeText(text) {
      return text.toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/[.,?!;:'"()]/g, '')
        .replace(/\s+/g, ' ').trim();
    }

    // Feedback
    function showFeedback(isCorrect, correctAnswer, question, analysis) {
      if (isCorrect) {
        elements.feedbackIcon.className = 'fas fa-check-circle';
        elements.feedbackTitle.textContent = 'Resposta Correta!';
        elements.feedbackIcon.style.color = 'var(--success)';
        elements.retryContainer.classList.add('hidden');
      } else {
        elements.feedbackIcon.className = 'fas fa-times-circle';
        elements.feedbackTitle.textContent = currentState.currentAttempt === 1 ? 'Quase lá! Veja o feedback:' : 'Resposta Incorreta';
        elements.feedbackIcon.style.color = 'var(--error)';
        if (currentState.currentAttempt === 1 && analysis.wordAnalysis.length > 0) {
          showWordAnalysis(analysis.wordAnalysis);
          elements.retryContainer.classList.remove('hidden');
        } else {
          elements.wordFeedbackArea.classList.add('hidden');
          elements.retryContainer.classList.add('hidden');
        }
      }
      elements.correctAnswer.textContent = correctAnswer;
      generateVocabTable(question);
      elements.feedbackArea.classList.remove('hidden');
      if (!isCorrect) currentState.currentQuestionAnalysis = analysis;
    }

    function showWordAnalysis(wordAnalysis) {
      elements.wordFeedbackContent.innerHTML = '';
      wordAnalysis.forEach(item => {
        const bubble = document.createElement('div');
        bubble.className = `word-bubble word-${item.status}`;
        if (item.status === 'correct') {
          bubble.textContent = item.userWord;
          bubble.title = 'Palavra correta na posição certa';
        } else if (item.status === 'wrong-position') {
          bubble.textContent = item.userWord;
          bubble.title = `Palavra existe mas deveria estar em outra posição. Correta: "${item.correctWord}"`;
        } else if (item.status === 'incorrect') {
          bubble.textContent = item.userWord;
          bubble.title = 'Palavra não existe na tradução correta';
        } else if (item.status === 'missing') {
          bubble.textContent = item.correctWord;
          bubble.title = 'Palavra faltando na sua resposta';
        }
        elements.wordFeedbackContent.appendChild(bubble);
      });
      elements.wordFeedbackArea.classList.remove('hidden');
    }

    function enableRetry() {
      currentState.currentAttempt = 2;
      elements.feedbackArea.classList.add('hidden');
      elements.answerInput.value = '';
      elements.answerInput.focus();
    }

    function generateVocabTable(question) {
    // Se existir tradução palavra por palavra definida, use-a
    if (question.wordByWord) {
      let html = '';
      question.wordByWord.forEach(pair => {
        html += `<tr><td><strong>${pair.english}</strong></td><td>${pair.portuguese}</td></tr>`;
      });
      elements.vocabTable.innerHTML = html;
      return;
    }
    
    // Fallback para o método antigo (caso alguma frase não tenha wordByWord)
    const englishGroups = groupWords(question.english, 'en');
    const portugueseGroups = groupWords(question.portuguese, 'pt');
    
    let html = '';
    const max = Math.max(englishGroups.length, portugueseGroups.length);
    
    for (let i = 0; i < max; i++) {
      const en = englishGroups[i] || '';
      const pt = portugueseGroups[i] || '';
      if (en.trim() || pt.trim()) {
        html += `<tr><td><strong>${en}</strong></td><td>${pt}</td></tr>`;
      }
    }
    
    elements.vocabTable.innerHTML = html || `<tr><td colspan="2" class="text-center">Não foi possível gerar o vocabulário.</td></tr>`;
  }

    function groupWords(text, language) {
      // Remove pontuação no final mas mantém para análise
      const cleanText = text.replace(/[.,?!;:]$/, '');
      const words = cleanText.split(' ').filter(w => w.trim() !== '');
      const groups = [];
      let i = 0;
      
      while (i < words.length) {
        let currentWord = words[i];
        
        // Verifica contrações e expressões comuns
        if (language === 'en') {
          // Contrações em inglês
          const contractions = ["i'm", "you're", "he's", "she's", "it's", "we're", "they're", 
                              "i've", "you've", "we've", "they've", "can't", "don't", "doesn't", 
                              "didn't", "isn't", "aren't", "wasn't", "weren't"];
          
          if (contractions.includes(currentWord.toLowerCase())) {
            groups.push(currentWord);
            i++;
            continue;
          }
          
          // Expressões de 2 palavras em inglês
          if (i + 1 < words.length) {
            const twoWords = `${currentWord} ${words[i + 1]}`.toLowerCase();
            const englishPhrases = [
              "such a", "great song", "run into", "eye contact", "lost in", 
              "a little", "a few", "a long", "all of", "turn up", "turn down",
              "hardly anyone", "no matter", "how many", "each other", "looking at",
              "wonder if", "music major", "made eye", "even though", "i guess",
              "things like", "can't concentrate", "let's listen", "should i",
              "this song", "the intro", "i've heard", "first verse", "so good",
              "i wish", "there were", "talk to", "about this", "long afternoon",
              "why does", "sound muffled", "cheap earphones", "break already",
              "the volume", "excuse me", "phone's volume", "hear it", "from over",
              "earphones weren't", "these cheap", "do you", "like that", "that song",
              "from the", "i like", "i do", "he doesn't", "fit the", "current trend",
              "promote himself", "communicate at", "if he", "did a", "would get",
              "spread everywhere", "doesn't do", "he should", "show his", "i'd like",
              "meet him", "as a", "i'm curious", "what he", "looks like", "it's also",
              "to just", "watch him", "live the", "way he", "it's good", "focuses on",
              "anything else", "mysterious concept", "is fine", "i liked", "the way",
              "just as", "we have", "each other", "let's just", "we don't", "know each",
              "otherwise she", "will know", "i was", "the train", "is arriving",
              "i thought", "you knew", "since you've", "always been", "staring at"
            ];
            
            if (englishPhrases.includes(twoWords)) {
              groups.push(twoWords);
              i += 2;
              continue;
            }
          }
        } else {
          // Português
          // Expressões de 2 palavras em português
          if (i + 1 < words.length) {
            const twoWords = `${currentWord} ${words[i + 1]}`.toLowerCase();
            const portuguesePhrases = [
              "é uma", "tão ótima", "de novo", "várias vezes", "contato visual", 
              "perdido em", "um pouco", "algumas vezes", "há muito", "da próxima",
              "por que", "o que", "que eu", "se ela", "eu me", "me pergunto", "se eu",
              "eu estava", "ela está", "nós vamos", "você poderia", "é bom", "é assim",
              "não é", "também é", "é só", "se concentre", "na criação", "mais nada",
              "tão bom", "quase ninguém", "se eu for", "com um", "ou um", "ela vai",
              "eu vou", "ela teria", "você também", "está preocupado", "de repente",
              "significa que", "estou preocupado", "ela pensasse", "que eu era",
              "a mesma", "há muito tempo", "da mesma forma", "ao lado", "em pé",
              "mal-entendidos", "mais longe", "sem dizer", "fique à vontade",
              "aquela garota", "já cruzei", "com ela", "está indo", "aquela pessoa",
              "vamos pegar", "mesmo último", "olhando para", "o instrumento",
              "ela carrega", "estudante de", "ou talvez", "em uma", "nós fizemos",
              "como um", "embora a", "gente se", "encontre aqui", "com frequência",
              "só eu", "estou ciente", "coisas como", "apenas coincidências",
              "não destino", "não consigo", "me concentrar", "na leitura", "vamos ouvir",
              "devo ouvir", "esta música", "a introdução", "desta música", "não importa",
              "quantas vezes", "tenha ouvido", "primeiro verso", "uma música"
            ];
            
            if (portuguesePhrases.includes(twoWords)) {
              groups.push(twoWords);
              i += 2;
              continue;
            }
          }
        }
        
        // Palavra individual
        groups.push(currentWord);
        i++;
      }
      
      return groups;
    }
    
    // Próxima questão
    function nextQuestion() {
      currentState.currentQuestionIndex++;
      if (currentState.currentQuestionIndex < currentState.currentQuestions.length) {
        loadQuestion();
      } else {
        if (!currentState.isReviewMode && currentState.wrongAnswers.length > 0) {
          currentState.isReviewMode = true;
          currentState.currentQuestions = [...currentState.wrongAnswers];
          currentState.currentQuestionIndex = 0;
          currentState.wrongAnswers = [];
          loadQuestion();
        } else {
          showResults();
        }
      }
    }

    // Resultados
    function showResults() {
      hideAllScreens();
      elements.resultsScreen.classList.remove('hidden');
      const total = currentState.currentLevel.phrases.length;
      const totalAttempts = currentState.correctCount + currentState.wrongCount;
      const correctPerc = totalAttempts ? Math.round((currentState.correctCount / totalAttempts) * 100) : 0;
      const completionPerc = Math.round((currentState.correctCount / total) * 100);
      elements.scoreCircle.style.background = `conic-gradient(var(--primary) ${correctPerc}%, var(--dark) 0%)`;
      elements.scoreValue.textContent = `${correctPerc}%`;
      if (completionPerc === 100) {
        elements.completionMessage.textContent = 'Parabéns! Domínio Total! 🎉';
        elements.completionMessage.style.color = 'var(--success)';
      } else if (completionPerc >= 80) {
        elements.completionMessage.textContent = 'Excelente! Quase Perfeito! 👏';
        elements.completionMessage.style.color = 'var(--success)';
      } else if (completionPerc >= 60) {
        elements.completionMessage.textContent = 'Bom Trabalho! Continue Assim! 💪';
        elements.completionMessage.style.color = 'var(--warning)';
      } else {
        elements.completionMessage.textContent = 'Continue Praticando! Você Consegue! 📚';
        elements.completionMessage.style.color = 'var(--error)';
      }
      elements.correctAnswers.textContent = currentState.correctCount;
      elements.wrongAnswers.textContent = currentState.wrongCount;
      elements.completionRate.textContent = `${completionPerc}%`;
      elements.resultsSubtitle.textContent = `Capítulo ${currentState.currentChapter.id.toString().padStart(3, '0')} - ${currentState.currentLevel.name}`;
    }

    // Esconder todas as telas
    function hideAllScreens() {
      elements.mainMenu.classList.add('hidden');
      elements.chaptersMenu.classList.add('hidden');
      elements.levelMenu.classList.add('hidden');
      elements.practiceModeMenu.classList.add('hidden');
      elements.quizScreen.classList.add('hidden');
      elements.resultsScreen.classList.add('hidden');
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>