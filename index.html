<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English Pro - Aprenda com Hist√≥rias</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #f59e0b;
      --secondary-dark: #d97706;
      --dark: #1e293b;
      --darker: #0f172a;
      --light: #f8fafc;
      --gray: #64748b;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--darker), #1e1b4b);
      color: var(--light);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }
    .container {
      width: 100%;
      max-width: 800px;
      background-color: rgba(30, 41, 59, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      padding: 24px;
      text-align: center;
      position: relative;
    }
    .header h1 {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 8px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .header p {
      font-size: 16px;
      opacity: 0.9;
    }
    .content {
      padding: 32px;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 16px 24px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
    }
    .btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .btn:hover::after {
      left: 100%;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
    }
    .btn-secondary {
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      color: var(--darker);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4);
    }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    .btn-small {
      padding: 12px 20px;
      font-size: 16px;
      width: auto;
      display: inline-block;
      margin-right: 12px;
    }
    .chapters-grid, .levels-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }
    .chapter-card, .level-card {
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .chapter-card:hover, .level-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      border-color: var(--primary);
    }
    .chapter-number, .level-number {
      font-size: 14px;
      color: var(--gray);
      margin-bottom: 8px;
    }
    .chapter-title, .level-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .chapter-stats, .level-stats {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--gray);
    }
    .question-container {
      background: rgba(30, 41, 59, 0.7);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .question-number {
      font-size: 14px;
      color: var(--gray);
    }
    .progress-bar {
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    .progress {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transition: width 0.5s ease;
    }
    .question-text {
      font-size: 20px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 24px;
      line-height: 1.5;
      padding: 16px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 12px;
    }
    .input-container {
      margin-bottom: 24px;
    }
    .answer-input {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.5);
      color: white;
      font-size: 18px;
      transition: all 0.3s ease;
    }
    .answer-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }
    .feedback-container {
      background: rgba(15, 23, 42, 0.7);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border-left: 4px solid var(--primary);
    }
    .feedback-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .correct-answer {
      font-size: 18px;
      font-weight: 600;
      color: var(--success);
      margin-bottom: 16px;
      padding: 12px;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 8px;
    }
    .vocab-section {
      margin-top: 20px;
    }
    .vocab-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--secondary);
    }
    .vocab-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .vocab-table th, .vocab-table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .vocab-table th {
      color: var(--gray);
      font-weight: 500;
    }
    .word-feedback {
      margin: 16px 0;
      padding: 16px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 8px;
    }
    .word-feedback-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--secondary);
    }
    .word-feedback-content {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .word-bubble {
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }
    .word-correct {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      border: 1px solid var(--success);
    }
    .word-wrong-position {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
      border: 1px solid var(--warning);
    }
    .word-incorrect {
      background: rgba(239, 68, 68, 0.2);
      color: var(--error);
      border: 1px solid var(--error);
    }
    .word-missing {
      background: rgba(100, 116, 139, 0.2);
      color: var(--gray);
      border: 1px solid var(--gray);
      text-decoration: line-through;
    }
    .retry-container {
      text-align: center;
      margin-top: 20px;
      padding: 16px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 8px;
      border-left: 4px solid var(--warning);
    }
    .retry-message {
      font-size: 16px;
      margin-bottom: 12px;
      color: var(--warning);
    }
    .hidden {
      display: none !important;
    }
    .text-center {
      text-align: center;
    }
    .mt-4 {
      margin-top: 24px;
    }
    .mb-4 {
      margin-bottom: 24px;
    }
    .icon {
      margin-right: 8px;
    }
    .score-display {
      text-align: center;
      padding: 32px;
    }
    .score-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(var(--primary) 0%, var(--dark) 0%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      position: relative;
    }
    .score-circle::before {
      content: '';
      position: absolute;
      width: 100px;
      height: 100px;
      background: var(--darker);
      border-radius: 50%;
    }
    .score-value {
      position: relative;
      z-index: 1;
      font-size: 28px;
      font-weight: 700;
    }
    .completion-message {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      margin: 24px 0;
    }
    .stat {
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }
    .stat-label {
      font-size: 14px;
      color: var(--gray);
    }
    @media (max-width: 600px) {
      .content {
        padding: 20px;
      }
      .header h1 {
        font-size: 24px;
      }
      .question-text {
        font-size: 18px;
      }
      .btn {
        padding: 14px 20px;
        font-size: 16px;
      }
      .chapters-grid, .levels-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Menu Principal -->
    <div id="main-menu">
      <div class="header">
        <h1><i class="fas fa-language icon"></i>English Pro</h1>
        <p>Aprenda ingl√™s com suas hist√≥rias favoritas</p>
      </div>
      <div class="content">
        <button id="story-mode-btn" class="btn btn-primary">
          <i class="fas fa-book-open icon"></i>Ingl√™s com Hist√≥ria
        </button>
      </div>
    </div>

    <!-- Sele√ß√£o de Cap√≠tulo -->
    <div id="chapters-menu" class="hidden">
      <div class="header">
        <button id="back-to-main" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1><i class="fas fa-book icon"></i>Cap√≠tulos</h1>
        <p>Selecione um cap√≠tulo para praticar</p>
      </div>
      <div class="content">
        <div class="chapters-grid" id="chapters-grid"></div>
      </div>
    </div>

    <!-- Sele√ß√£o de N√≠vel -->
    <div id="level-menu" class="hidden">
      <div class="header">
        <button id="back-to-chapters" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1 id="chapter-level-title">Cap√≠tulo </h1>
        <p>Escolha um n√≠vel para praticar</p>
      </div>
      <div class="content">
        <div class="levels-grid" id="levels-grid"></div>
      </div>
    </div>

    <!-- Modo de Pr√°tica -->
    <div id="practice-mode-menu" class="hidden">
      <div class="header">
        <button id="back-to-levels" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1 id="level-practice-title">N√≠vel </h1>
        <p>Selecione o modo de pr√°tica</p>
      </div>
      <div class="content">
        <button id="easy-practice-btn" class="btn btn-primary">
          <i class="fas fa-star icon"></i>Pr√°tica F√°cil<br><small>Traduza do Ingl√™s para Portugu√™s</small>
        </button>
        <button id="hard-practice-btn" class="btn btn-secondary">
          <i class="fas fa-fire icon"></i>Pr√°tica Dif√≠cil<br><small>Traduza do Portugu√™s para Ingl√™s</small>
        </button>
      </div>
    </div>

    <!-- Quiz -->
    <div id="quiz-screen" class="hidden">
      <div class="header">
        <button id="back-to-practice" class="btn btn-outline btn-small">
          <i class="fas fa-arrow-left icon"></i>Voltar
        </button>
        <h1 id="quiz-title">Pr√°tica</h1>
        <p id="quiz-subtitle">Traduza a frase abaixo</p>
      </div>
      <div class="content">
        <div class="question-container">
          <div class="question-header">
            <div class="question-number" id="question-number">Quest√£o 1 de 5</div>
            <div class="question-stats" id="question-stats">Acertos: 0 | Erros: 0</div>
          </div>
          <div class="progress-bar">
            <div class="progress" id="progress-bar" style="width: 0%"></div>
          </div>
          <div class="question-text" id="question-text"></div>
          <div class="input-container">
            <input type="text" class="answer-input" id="answer-input" placeholder="Digite sua tradu√ß√£o aqui...">
          </div>
          <button id="submit-answer" class="btn btn-primary">Verificar Resposta</button>
          <button id="skip-button" class="btn btn-outline mt-4">Pular Frase</button>
        </div>
        <div id="feedback-area" class="feedback-container hidden">
          <div class="feedback-title">
            <i class="fas fa-info-circle" id="feedback-icon"></i>
            <span id="feedback-title-text">Feedback</span>
          </div>
          <div class="correct-answer" id="correct-answer"></div>
          <div id="word-feedback-area" class="word-feedback hidden">
            <div class="word-feedback-title">
              <i class="fas fa-spell-check icon"></i>An√°lise das Palavras:
            </div>
            <div class="word-feedback-content" id="word-feedback-content"></div>
          </div>
          <div id="retry-container" class="retry-container hidden">
            <div class="retry-message">
              <i class="fas fa-redo-alt icon"></i>Tente novamente corrigindo as palavras destacadas
            </div>
            <button id="retry-button" class="btn btn-primary btn-small">Tentar Novamente</button>
          </div>
          <div class="vocab-section">
            <div class="vocab-title">
              <i class="fas fa-book icon"></i>Tradu√ß√£o das Palavras
            </div>
            <table class="vocab-table" id="vocab-table"></table>
          </div>
          <button id="next-question" class="btn btn-primary mt-4">Pr√≥xima Quest√£o</button>
        </div>
      </div>
    </div>

    <!-- Resultados -->
    <div id="results-screen" class="hidden">
      <div class="header">
        <h1><i class="fas fa-trophy icon"></i>Resultados</h1>
        <p id="results-subtitle">Desempenho no n√≠vel</p>
      </div>
      <div class="content">
        <div class="score-display">
          <div class="score-circle" id="score-circle">
            <div class="score-value" id="score-value">0%</div>
          </div>
          <div class="completion-message" id="completion-message">Parab√©ns!</div>
          <div class="stats">
            <div class="stat">
              <div class="stat-value" id="correct-answers">0</div>
              <div class="stat-label">Acertos</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="wrong-answers">0</div>
              <div class="stat-label">Erros</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="completion-rate">0%</div>
              <div class="stat-label">Conclu√≠do</div>
            </div>
          </div>
          <button id="restart-practice" class="btn btn-primary">Refazer Pr√°tica</button>
          <button id="back-to-chapters-from-results" class="btn btn-outline mt-4">Voltar aos Cap√≠tulos</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const CHAPTERS = [
      {
        id: 1,
        title: "Chapter 001",
        description: "O In√≠cio da Jornada",
        levels: [
          {
            id: 1,
            name: "N√≠vel 1",
            description: "Frases curtas e diretas",
            estimatedTime: "~1 minuto",
            phrases: [
              { english: "I'm so mad", portuguese: "Eu estou t√£o bravo.", alternativeTranslations: ["Eu estou com tanta raiva.", "Eu estou t√£o irritado."] },
              { english: "What kind of skill is this?!", portuguese: "Que tipo de habilidade √© essa?!", alternativeTranslations: [] },
              { english: "Who's Been saying the same thing", portuguese: "Quem tem dito a mesma coisa?", alternativeTranslations: ["Quem andou dizendo a mesma coisa?"] },
              { english: "The tower is moved by your determination", portuguese: "A torre √© movida pela sua determina√ß√£o", alternativeTranslations: [] },
              { english: "The tower praises you for your achievements.", portuguese: "A torre te elogia pelas suas conquistas.", alternativeTranslations: ["A torre te parabeniza pelas suas conquistas."] }
            ]
          },
          {
            id: 2,
            name: "N√≠vel 2",
            description: "Frases com um pouco mais de contexto",
            estimatedTime: "~1 minuto",
            phrases: [
              { english: "Could it be... a 'skill card'", portuguese: "Ser√° que √©... uma 'carta de habilidade'?", alternativeTranslations: [] },
              { english: "What did you mean by that?!", portuguese: "O que voc√™ quis dizer com isso?!", alternativeTranslations: ["O que voc√™ quis dizer com aquilo?!"] },
              { english: "The tower rewards you for your honest efforts.", portuguese: "A torre recompensa voc√™ pelos seus esfor√ßos honestos.", alternativeTranslations: [] },
              { english: "This is different from what I saw in the videos!?", portuguese: "Isto √© diferente do que eu vi nos v√≠deos!?", alternativeTranslations: [] },
              { english: "An unsightly envy that is yet to be found in history!", portuguese: "Uma inveja desagrad√°vel que ainda n√£o se encontra na hist√≥ria!", alternativeTranslations: ["Uma inveja nojenta que ainda n√£o se encontra na hist√≥ria!"] }
            ]
          },
          {
            id: 3,
            name: "N√≠vel 3",
            description: "Frases com personagens e emo√ß√£o",
            estimatedTime: "~1 minuto",
            phrases: [
              { english: "I want to be like flame emperor too", portuguese: "Eu tamb√©m quero ser como o Imperador das Chamas.", alternativeTranslations: [] },
              { english: "What?!?! Saint is dating Flame Emperor?!?!", portuguese: "O qu√™?!?! A Santa est√° namorando o Imperador das Chamas?!?!", alternativeTranslations: [] },
              { english: "I want to succeed with my own skills too", portuguese: "Eu tamb√©m quero ter sucesso com as minhas pr√≥prias habilidades.", alternativeTranslations: [] },
              { english: "On top of that, a gold card is an S-rank skill...!", portuguese: "Al√©m disso, um cart√£o dourado √© uma habilidade de rank S...!", alternativeTranslations: [] },
              { english: "A hunter who literally writes legends.", portuguese: "Um ca√ßador que literalmente escreve lendas.", alternativeTranslations: [] }
            ]
          }
        ]
      }
    ];

    let currentState = {
      currentChapter: null,
      currentLevel: null,
      currentMode: null,
      currentQuestions: [],
      wrongAnswers: [],
      currentQuestionIndex: 0,
      correctCount: 0,
      wrongCount: 0,
      isReviewMode: false,
      currentAttempt: 1
    };

    const elements = {
      mainMenu: document.getElementById('main-menu'),
      chaptersMenu: document.getElementById('chapters-menu'),
      levelMenu: document.getElementById('level-menu'),
      practiceModeMenu: document.getElementById('practice-mode-menu'),
      quizScreen: document.getElementById('quiz-screen'),
      resultsScreen: document.getElementById('results-screen'),
      storyModeBtn: document.getElementById('story-mode-btn'),
      backToMain: document.getElementById('back-to-main'),
      backToChapters: document.getElementById('back-to-chapters'),
      backToLevels: document.getElementById('back-to-levels'),
      backToPractice: document.getElementById('back-to-practice'),
      backToChaptersFromResults: document.getElementById('back-to-chapters-from-results'),
      chaptersGrid: document.getElementById('chapters-grid'),
      levelsGrid: document.getElementById('levels-grid'),
      chapterLevelTitle: document.getElementById('chapter-level-title'),
      levelPracticeTitle: document.getElementById('level-practice-title'),
      quizTitle: document.getElementById('quiz-title'),
      quizSubtitle: document.getElementById('quiz-subtitle'),
      questionNumber: document.getElementById('question-number'),
      questionStats: document.getElementById('question-stats'),
      progressBar: document.getElementById('progress-bar'),
      questionText: document.getElementById('question-text'),
      answerInput: document.getElementById('answer-input'),
      submitAnswer: document.getElementById('submit-answer'),
      skipButton: document.getElementById('skip-button'),
      feedbackArea: document.getElementById('feedback-area'),
      feedbackIcon: document.getElementById('feedback-icon'),
      feedbackTitle: document.getElementById('feedback-title-text'),
      correctAnswer: document.getElementById('correct-answer'),
      vocabTable: document.getElementById('vocab-table'),
      wordFeedbackArea: document.getElementById('word-feedback-area'),
      wordFeedbackContent: document.getElementById('word-feedback-content'),
      retryContainer: document.getElementById('retry-container'),
      retryButton: document.getElementById('retry-button'),
      nextQuestion: document.getElementById('next-question'),
      resultsSubtitle: document.getElementById('results-subtitle'),
      scoreCircle: document.getElementById('score-circle'),
      scoreValue: document.getElementById('score-value'),
      completionMessage: document.getElementById('completion-message'),
      correctAnswers: document.getElementById('correct-answers'),
      wrongAnswers: document.getElementById('wrong-answers'),
      completionRate: document.getElementById('completion-rate'),
      restartPractice: document.getElementById('restart-practice'),
      easyPracticeBtn: document.getElementById('easy-practice-btn'),
      hardPracticeBtn: document.getElementById('hard-practice-btn')
    };

    function init() {
      renderChapters();
      attachListeners();
    }

    function attachListeners() {
      elements.storyModeBtn.addEventListener('click', () => {
        hideAll();
        elements.chaptersMenu.classList.remove('hidden');
      });
      elements.backToMain.addEventListener('click', () => {
        hideAll();
        elements.mainMenu.classList.remove('hidden');
      });
      elements.backToChapters.addEventListener('click', () => {
        hideAll();
        elements.chaptersMenu.classList.remove('hidden');
      });
      elements.backToLevels.addEventListener('click', () => {
        showLevelMenu(currentState.currentChapter);
      });
      elements.backToPractice.addEventListener('click', () => {
        showPracticeModeMenu(currentState.currentLevel);
      });
      elements.backToChaptersFromResults.addEventListener('click', () => {
        hideAll();
        elements.chaptersMenu.classList.remove('hidden');
      });
      elements.easyPracticeBtn.addEventListener('click', () => startPractice('easy'));
      elements.hardPracticeBtn.addEventListener('click', () => startPractice('hard'));
      elements.submitAnswer.addEventListener('click', checkAnswer);
      elements.skipButton.addEventListener('click', skipQuestion);
      elements.nextQuestion.addEventListener('click', nextQuestion);
      elements.retryButton.addEventListener('click', () => {
        currentState.currentAttempt = 2;
        elements.feedbackArea.classList.add('hidden');
        elements.answerInput.value = '';
        elements.answerInput.focus();
      });
      elements.restartPractice.addEventListener('click', () => startPractice(currentState.currentMode));
      elements.answerInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          if (elements.feedbackArea.classList.contains('hidden')) {
            checkAnswer();
          } else if (!elements.retryContainer.classList.contains('hidden')) {
            elements.retryButton.click();
          } else {
            elements.nextQuestion.click();
          }
        }
      });
    }

    function renderChapters() {
      elements.chaptersGrid.innerHTML = CHAPTERS.map(ch => `
        <div class="chapter-card" data-id="${ch.id}">
          <div class="chapter-number">Cap√≠tulo ${ch.id.toString().padStart(3, '0')}</div>
          <div class="chapter-title">${ch.title}</div>
          <div class="chapter-stats">
            <span>3 n√≠veis</span>
            <span><i class="fas fa-star"></i> ${ch.id}.0</span>
          </div>
        </div>
      `).join('');

      document.querySelectorAll('.chapter-card').forEach(card => {
        card.addEventListener('click', () => {
          const id = parseInt(card.dataset.id);
          const chapter = CHAPTERS.find(c => c.id === id);
          if (chapter) {
            showLevelMenu(chapter);
          }
        });
      });
    }

    function showLevelMenu(chapter) {
      currentState.currentChapter = chapter;
      elements.chapterLevelTitle.textContent = `Cap√≠tulo ${chapter.id.toString().padStart(3, '0')} - ${chapter.title}`;
      elements.levelsGrid.innerHTML = chapter.levels.map(level => `
        <div class="level-card" data-id="${level.id}">
          <div class="level-number">${level.name}</div>
          <div class="level-title">${level.description}</div>
          <div class="level-stats">
            <span>5 frases</span>
            <span>${level.estimatedTime}</span>
          </div>
        </div>
      `).join('');

      document.querySelectorAll('.level-card').forEach(card => {
        card.addEventListener('click', () => {
          const id = parseInt(card.dataset.id);
          const level = chapter.levels.find(l => l.id === id);
          if (level) {
            showPracticeModeMenu(level);
          }
        });
      });

      hideAll();
      elements.levelMenu.classList.remove('hidden');
    }

    function showPracticeModeMenu(level) {
      currentState.currentLevel = level;
      elements.levelPracticeTitle.textContent = `${level.name} - ${level.description}`;
      hideAll();
      elements.practiceModeMenu.classList.remove('hidden');
    }

    function startPractice(mode) {
      currentState.currentMode = mode;
      currentState.currentQuestions = [...currentState.currentLevel.phrases];
      currentState.wrongAnswers = [];
      currentState.currentQuestionIndex = 0;
      currentState.correctCount = 0;
      currentState.wrongCount = 0;
      currentState.isReviewMode = false;
      currentState.currentAttempt = 1;
      showQuiz();
      loadQuestion();
    }

    function showQuiz() {
      hideAll();
      elements.quizScreen.classList.remove('hidden');
      elements.quizTitle.textContent = `Pr√°tica ${currentState.currentMode === 'easy' ? 'F√°cil' : 'Dif√≠cil'}`;
      elements.quizSubtitle.textContent = currentState.currentMode === 'easy'
        ? 'Traduza do Ingl√™s para Portugu√™s'
        : 'Traduza do Portugu√™s para Ingl√™s';
    }

    function loadQuestion() {
      const q = currentState.currentQuestions[currentState.currentQuestionIndex];
      const total = currentState.currentQuestions.length;
      elements.questionNumber.textContent = `Quest√£o ${currentState.currentQuestionIndex + 1} de ${total}`;
      elements.questionStats.textContent = `Acertos: ${currentState.correctCount} | Erros: ${currentState.wrongCount}`;
      elements.progressBar.style.width = `${(currentState.currentQuestionIndex / total) * 100}%`;
      elements.questionText.textContent = currentState.currentMode === 'easy' ? q.english : q.portuguese;
      elements.answerInput.value = '';
      elements.feedbackArea.classList.add('hidden');
      elements.wordFeedbackArea.classList.add('hidden');
      elements.retryContainer.classList.add('hidden');
      elements.answerInput.focus();
      currentState.currentAttempt = 1;
    }

    function skipQuestion() {
      currentState.wrongCount++;
      currentState.currentQuestionIndex++;
      if (currentState.currentQuestionIndex < currentState.currentQuestions.length) {
        loadQuestion();
      } else {
        showResults();
      }
    }

    function checkAnswer() {
      const user = elements.answerInput.value.trim();
      if (!user) return;
      const q = currentState.currentQuestions[currentState.currentQuestionIndex];
      const correctList = [q.portuguese, ...q.alternativeTranslations];
      const isEasy = currentState.currentMode === 'easy';
      const normUser = normalize(user);
      const normCorrect = correctList.map(c => normalize(c));
      let isCorrect = normCorrect.includes(normUser);

      if (isCorrect) {
        currentState.correctCount++;
        showFeedback(true, correctList[0], q);
      } else {
        currentState.wrongCount++;
        showFeedback(false, correctList[0], q);
      }

      elements.questionStats.textContent = `Acertos: ${currentState.correctCount} | Erros: ${currentState.wrongCount}`;
    }

    function normalize(text) {
      return text.toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/[.,?!;:'"()]/g, '')
        .replace(/\s+/g, ' ').trim();
    }

    function showFeedback(isCorrect, correctAnswer, question) {
      elements.feedbackIcon.className = isCorrect ? 'fas fa-check-circle' : 'fas fa-times-circle';
      elements.feedbackIcon.style.color = isCorrect ? 'var(--success)' : 'var(--error)';
      elements.feedbackTitle.textContent = isCorrect ? 'Resposta Correta!' : 'Resposta Incorreta';
      elements.correctAnswer.textContent = correctAnswer;
      generateVocabTable(question);
      elements.retryContainer.classList.add('hidden');
      elements.wordFeedbackArea.classList.add('hidden');
      elements.feedbackArea.classList.remove('hidden');
    }

    function generateVocabTable(question) {
      const en = question.english.split(' ').slice(0, 8);
      const pt = question.portuguese.split(' ').slice(0, 8);
      let html = '';
      for (let i = 0; i < Math.max(en.length, pt.length); i++) {
        if ((en[i] || pt[i]) && en[i]?.trim() !== '' && pt[i]?.trim() !== '') {
          html += `<tr><td><strong>${en[i] || ''}</strong></td><td>${pt[i] || ''}</td></tr>`;
        }
      }
      elements.vocabTable.innerHTML = html || '<tr><td colspan="2">Vocabul√°rio n√£o dispon√≠vel.</td></tr>';
    }

    function nextQuestion() {
      currentState.currentQuestionIndex++;
      if (currentState.currentQuestionIndex < currentState.currentQuestions.length) {
        loadQuestion();
      } else {
        showResults();
      }
    }

    function showResults() {
      hideAll();
      elements.resultsScreen.classList.remove('hidden');
      const total = currentState.currentLevel.phrases.length;
      const correctPerc = Math.round((currentState.correctCount / (currentState.correctCount + currentState.wrongCount)) * 100) || 0;
      const completionPerc = Math.round((currentState.correctCount / total) * 100);
      elements.scoreCircle.style.background = `conic-gradient(var(--primary) ${correctPerc}%, var(--dark) 0%)`;
      elements.scoreValue.textContent = `${correctPerc}%`;
      if (completionPerc === 100) {
        elements.completionMessage.textContent = 'Parab√©ns! Dom√≠nio Total! üéâ';
        elements.completionMessage.style.color = 'var(--success)';
      } else if (completionPerc >= 80) {
        elements.completionMessage.textContent = 'Excelente! Quase Perfeito! üëè';
        elements.completionMessage.style.color = 'var(--success)';
      } else if (completionPerc >= 60) {
        elements.completionMessage.textContent = 'Bom Trabalho! Continue Assim! üí™';
        elements.completionMessage.style.color = 'var(--warning)';
      } else {
        elements.completionMessage.textContent = 'Continue Praticando! Voc√™ Consegue! üìö';
        elements.completionMessage.style.color = 'var(--error)';
      }
      elements.correctAnswers.textContent = currentState.correctCount;
      elements.wrongAnswers.textContent = currentState.wrongCount;
      elements.completionRate.textContent = `${completionPerc}%`;
      elements.resultsSubtitle.textContent = `${currentState.currentChapter.title} - ${currentState.currentLevel.name}`;
    }

    function hideAll() {
      Object.values(elements).forEach(el => {
        if (el && el.classList) el.classList.add('hidden');
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>